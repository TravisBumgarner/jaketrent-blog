<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: sql | Jake Trent]]></title>
  <link href="http://jaketrent.com/blog/categories/sql/atom.xml" rel="self"/>
  <link href="http://jaketrent.com/"/>
  <updated>2016-03-14T15:03:04-06:00</updated>
  <id>http://jaketrent.com/</id>
  <author>
    <name><![CDATA[Jake Trent]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Not in vs. Outer join Performance]]></title>
    <link href="http://jaketrent.com/post/not-vs-outer-join-performance/"/>
    <updated>2009-09-17T12:59:00-06:00</updated>
    <id>http://jaketrent.com/post/not-vs-outer-join-performance</id>
    <content type="html"><![CDATA[<p>I was running an SQL query today and it was sooooo slow.  So slow, in fact, that it never returned.  I asked the DBA, Reed, who built the table what might be up, and he informed me that it was not indexed.  And proceeded to show me some cool stuff I could do to actually get my query to return.  In the end, it was a comparison between the "not in" operator and a "left join".</p>

<!--more-->


<p>My original query was thus, names changed to protect the innocent:</p>

<p><code>sql
select count(*)
from   temp_legacy_attachments i
where  i.person_id not in (
  select m.legacy_person_id
  from   new_attachment a
  ,      person p
  where  a.person_id = p.id);
</code></p>

<p>I was trying to query the temp_legacy_attachments to get all rows that didn't have a record in the new_attachments table.  It never returned, and so Reed told me to give this one a try:</p>

<p><code>sql
select count(*)
from   temp_legacy_attachments i
left join (
  select m.legacy_person_id
  from   new_attachment a
  ,      person p
  where  a.person_id = p.id) ea on ea.legacy_person_id = i.person_id
where ea.legacy_person_id is null ;
</code></p>

<p>So, instead of using "not in" a set, I select all the legacy rows, then outer join to the new_attachment rows and filter where a column on the new attachment set is null (it's the smaller/less-available set).</p>

<p>I thought it was pretty sweet.  No magic bullet, though, as Reed tells me that there is a fair amount of debate over the performance difference between the two methods.  You just have to try it and find out.  For me, in this case, the outer join was more awesome.</p>

<h3>Update</h3>

<p>Another savvy DBA, Bill, has graced us with another method yet:</p>

<p>```sql
select sum(cnt)
from (
  select p.legacy_person_id
  ,      count(*) cnt
  from   person p
  join   temp_legacy_attachments i on i.person_id = p.legacy_person_id
  where  not exists</p>

<pre><code>(select null
from   new_attachments a
where  a.person_id = p.id
and    a.created_by = 'LEGACY_MIGRATION')
</code></pre>

<p>  group by p.legacy_person_id)
```</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Count number of characters w/ SQL]]></title>
    <link href="http://jaketrent.com/post/count-number-characters-w-sql/"/>
    <updated>2009-04-30T07:12:00-06:00</updated>
    <id>http://jaketrent.com/post/count-number-characters-w-sql</id>
    <content type="html"><![CDATA[<p>There's no pre-defined method to count the number of occurrences of a certain character in a database table column using SQL.  There's a quick and dirty way to get it done however.  In my case, I wanted to figure out how many lines existed in a column that held address information, separated by line breaks.  Here's a spot of code that helped from the friendly neighborhood DBA, Reed.</p>

<!--more-->


<p><code>sql
select addresstxt
,      length(addresstxt)
,      length (replace(addresstxt,chr(13),''))
,      length(addresstxt) - length (replace(addresstxt,chr(13),''))
from   contact_info
where  length(addresstxt) - length (replace(addresstxt,chr(13),'')) &gt; 4
</code></p>

<p>I was actually looking for addresses that were over 4 lines long, hence the where clause.  The chr() function gets the character represented by the given ascii code.  13 is new line.  10 is line feed.  You may want to use one or the other depending on your data.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Show Full SQL Developer Timestamp]]></title>
    <link href="http://jaketrent.com/post/show-full-sql-developer-timestamp/"/>
    <updated>2009-04-08T08:06:00-06:00</updated>
    <id>http://jaketrent.com/post/show-full-sql-developer-timestamp</id>
    <content type="html"><![CDATA[<p>In Oracle's SQL Developer 1.5 tool, there seems to be a crazy bug where one can't see the full timestamp value (including time) by default.  You can change this by running this awesome piece of code...</p>

<!--more-->


<p><code>sql
alter session set nls_date_format = 'MM/DD/YYYY HH24:MI:SS';
</code></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[These Aren't the Tables You're Looking For]]></title>
    <link href="http://jaketrent.com/post/these-arent-tables-youre-looking/"/>
    <updated>2008-10-14T14:15:00-06:00</updated>
    <id>http://jaketrent.com/post/these-arent-tables-youre-looking</id>
    <content type="html"><![CDATA[<p>Sometimes you have a large database schema and a lot of tables that you're not sure what they contain.  You do know, however, the nature of the data'ific needle that you're trying to find in your schema'ific schema.  Oracle provides some cool dictionary tables that might help you in your quest.</p>

<!--more-->


<p>Sometimes you have a large database schema and a lot of tables that you're not sure what they contain.  You do know, however, the nature of the data'ific needle that you're trying to find in your schema'ific schema.  Oracle provides some cool dictionary tables that might help you in your quest.</p>

<p>Try to find what you're looking for by table name:</p>

<p><code>sql
select *
from   dba_tab_cols
where  owner = 'SCHEMA_NAME'
and    table_name like '%SWEET%';
</code></p>

<p>Try to find what you're looking for by column name:</p>

<p><code>sql
select *
from   dba_tab_cols
where  owner = 'SCHEMA_NAME'
and    column_name like '%COOLNESS%';
</code></p>
]]></content>
  </entry>
  
</feed>
