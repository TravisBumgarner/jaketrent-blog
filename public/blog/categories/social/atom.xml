<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: social | Jake Trent]]></title>
  <link href="http://jaketrent.com/blog/categories/social/atom.xml" rel="self"/>
  <link href="http://jaketrent.com/"/>
  <updated>2015-09-23T16:23:11-06:00</updated>
  <id>http://jaketrent.com/</id>
  <author>
    <name><![CDATA[Jake Trent]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[How to Make a Pinterest Webservice]]></title>
    <link href="http://jaketrent.com/post/how-to-make-pinterest-webservice/"/>
    <updated>2013-01-18T07:06:00-07:00</updated>
    <id>http://jaketrent.com/post/how-to-make-pinterest-webservice</id>
    <content type="html"><![CDATA[<p>Pinterest currently does not have an official webservice API.  It seems kind of crazy in this day and age.  They really should have one.  I can't think what the business reasons might be for not having one.</p>

<p>They've not had one for long enough that it's high time we write our own.  It'll be surprisingly easy with a few choice tools</p>

<p><img src="http://i.imgur.com/7cv9d.png" alt="Pinterest API" /></p>

<!--more-->


<h2>Webservice API on NodeJs</h2>

<p><a href="http://nodejs.org/">NodeJs</a> is just a fun platform to write IO-heavy applications for the web.  We're going to write a quick <a href="http://en.wikipedia.org/wiki/Representational_state_transfer">RESTful</a> endpoint using the <a href="http://expressjs.com/">Express</a> library that allows us to consume real Pinterest content that's not available via a pre-existing service.</p>

<h4>Screen Scrape Pinterest</h4>

<p>Given no API, we're left to our own devices.  The data for Pinterest is only exposed via the UI on the website.  We're going to have our service visit that UI and grab the data that we need as a user of a web browser would see it.  This is screen scraping.  There a lot of downsides here, but we wouldn't be trying it if there was an API already.</p>

<p>One down side is that our service will be brittle.  If Pinterest ever changes the layout of the page, our service won't be able to bring back the right data.  Our solution will be simple, so it'll be easy to update, but this should be a red flag not to do anything mission critical via screen scraping unless you're giving it your full attention.</p>

<p>Another down side might be speed.  Screen scraping a UI is not the fastest way to get data.  We'll try and help mitigate this with the fastest tools that we have.  NodeJs is a blasted fast web server.  A library called <a href="https://github.com/MatthewMueller/cheerio">cheerio</a> is supposedly best-in-class for screen scraping (advertised as 8x faster than <a href="https://github.com/tmpvar/jsdom">jsdom</a>).</p>

<h4>Caching</h4>

<p>To make this retrieval even faster for repeat use, caching could be very helpful.  We could cache in our service what we get back from pinterest via some datastore or we could cache in our client.  Best practices here will be very dependent on your use case.  These kind of enhancements have been made over and over again and would only clutter the simple Pinterest interaction, so I will exclude them for now.</p>

<h2>Getting Pinterest Data</h2>

<p>Here's the final solution in all its glory.  This snippet only includes only the code inside the Express route.</p>

<p>{% codeblock lang:javascript %}
// request is a library for making http requests
var request = require('request');</p>

<p>// cheerio is a lib for screen scraping
var cheerio = require('cheerio');</p>

<p>// req and res are express vars for the request and response
exports.list = function (req, res) {</p>

<p>  // this is the actual request to the pinterest page I care about
  request('http://pinterest.com/jaketrent/pins/', function(err, resp, body){</p>

<pre><code>// get ready for scraping
var $ = cheerio.load(body);
var pins = [];
var $pin;
var $pins = $('.pin');

var i = 0;

// scraping only the 1st 10 pins;  you could get them all
for (i; i &lt; 10; ++i) {
  $pin = $pins.eq(i);

  // Finding the bits on the page we care about based on class names
  pins.push({
    img: $pin.find('.PinImageImg').attr('src'),
    url: 'http://pinterest.com' + $pin.find('.ImgLink').attr('href'),
    desc: $pin.find('.description').text()
  });
}

// respond with the final json
res.send(pins);
</code></pre>

<p>  });
};
{% endcodeblock %}</p>

<p>When I wrote it out for my own use, I was surprised at the brevity.  I love it.  Given, there's no handling of any errors or attempts to make this semi-robust.  This just gets us the data on a good day.</p>

<p>The final json that's exposed at our chosen Express endpoint looks like it this:</p>

<p>{% codeblock lang:javascript %}
[ {</p>

<pre><code>"img": "http://myimg.jpg",
"url": "http://pinterest.com/pin/mypin",
"desc": "Sweetest pin ever"
</code></pre>

<p>  }, {
  // ...
]
{% endcodeblock %}</p>

<p>It's ready for use by a json-ready client.  So stinkin easy.  We're connecting the web together, and it's awesome!  Now the world will know of the baked goods and flower arrangements that we love the most.</p>
]]></content>
  </entry>
  
</feed>
