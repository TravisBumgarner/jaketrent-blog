
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Xquery Imports on MarkLogic - Jake Trent</title>

  <meta name="author" content="https://plus.google.com/115032056022257436849">
  
  <meta name="description" content="When a person looks at an Xquery module import, ... um, sorry... he usually gets distracted by something else before he can get to the semicolon at &hellip;">
  <meta name="keywords" content="marklogic, maven, xquery">
  <meta name="copyright" content="http://creativecommons.org/licenses/by/3.0/us/" />

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="Xquery Imports on MarkLogic" />
  <meta property="og:type" content="article" />
  
  <meta property="og:url" content="http://jaketrent.com/post/xquery-imports-marklogic/" />
  <meta property="og:description" content="When a person looks at an Xquery module import, ... um, sorry... he usually gets distracted by something else before he can get to the semicolon at &hellip;" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Xquery Imports on MarkLogic" />
  <meta name="twitter:description" content="When a person looks at an Xquery module import, ... um, sorry... he usually gets distracted by something else before he can get to the semicolon at &hellip;" />
  

  
  <link rel="canonical" href="http://jaketrent.com/post/xquery-imports-marklogic/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Jake Trent" type="application/atom+xml">
  <meta name="google-site-verification" content="uvx7BhaUTNz29nQgydsFPRsErfqYBhPEV_svnHvW7H0" />

<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-16224416-4']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <div class="container">
    <div class="sidebar">
      <section class="logo">
  <header class="logo-header">
    <h2 class="logo-title">
      <a class="logo-link" href="/">
        <span class="logo-img"></span>
      </a>
    </h2>
  </header>
</section>

      <nav class="main-nav" role="navigation"><ul class="main-nav-list">
  <li class="main-nav-item">
    <a class="main-nav-link" href="/">Blog</a>
  </li>
  <li class="main-nav-item">
    <a class="main-nav-link" href="/work">Work</a>
  </li>
  <li class="main-nav-item">
    <a class="main-nav-link" href="https://books.jaketrent.com">Books</a>
  </li>
  <li class="main-nav-item">
    <a class="main-nav-link" href="https://github.com/jaketrent">Github</a>
  </li>
  <li class="main-nav-item">
    <a class="main-nav-link" href="http://www.linkedin.com/in/jaketrent">LinkedIn</a>
  </li>
</ul>
</nav>
    </div>
    <div class="content">
      <div>
<article class="entry entry-detail" role="article">
  
  <header>
    
      <h1 class="entry-title">Xquery Imports on MarkLogic</h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-01-28T14:06:00-07:00" pubdate data-updated="true">Jan 28<span>th</span>, 2011</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>When a person looks at an Xquery module import, &#8230; um, sorry&#8230; he usually gets distracted by something else before he can get to the semicolon at the end of the statement.  They&#8217;re seriously long!  Few are the files in which one-line imports adhere to an 80 character width limit.  Read on for my other Martin Luther-spirited grievances.</p>

<!--more-->


<h2>Length</h2>

<p>Ridiculously long.  Example that speaks for itself:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>import module namespace translate = "http://aprilandjake.com/audience/modules/content/translate" at "/modules/content/translate.xqy";</span></code></pre></td></tr></table></div></figure>


<p>Ok, some of the blame here lies with me for picking a ridiculous namespace.  But it seems conventional to stick the domain on the front in proper URL fashion.  And then, I&#8217;m mirroring the path from app server root as the rest of the namespace, which takes me to repetition:</p>

<h2>Repetition</h2>

<p>Doesn&#8217;t it seem like we have the same data listed here twice.  From what I&#8217;m getting from the <a href="http://www.w3.org/TR/xquery/#id-module-import">W3C Xquery Spec</a>:</p>

<p>The URILiterals that follow the at keyword are optional location hints, and can be interpreted or disregarded in an implementation-defined way.</p>

<p>The implementation I&#8217;m operating in is MarkLogic.  As far as I can tell, then url after the &#8220;at&#8221; is required in this implementation.  Can anyone fulfill a boyish dream of mine and tell me otherwise?  Please!</p>

<p>So, I thought I was pretty cool creating a Live Template in IntelliJ to throw down this nasty import for my current project and save me a few keystrokes:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>import module namespace $NAME$ = "http://aprilandjake.com/audience$PATH$" at "$PATH$.xqy";</span></code></pre></td></tr></table></div></figure>


<p>So, then I could type the path from app server root to the library module file once and it would be duplicated, but now I get bitten by paths:</p>

<h2>Paths</h2>

<p>It seems like most of the Xquery code that I see uses absolute paths after the &#8220;at&#8221; in the import, as in:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>import module namespace myns = "http://super.long/namespace/of/modules/death" at "/modules/death.xqy";</span></code></pre></td></tr></table></div></figure>


<p>Note the leading slash.  So, I have done this in most of my code.  Remember, it helps my live template work as well (less typing overall).  Well, it seems that I may need to change my standard here, because the leading slash limits me, as I see it, in my code reuse.  Paraphrasing from the <a href="http://docs.marklogic.com/4.2doc/docapp.xqy#display.xqy?fname=http://pubs/4.2doc/xml/dev_guide/import_modules.xml%2329407">MarkLogic Documentation</a>:</p>

<p>Paths in imports are resolved as follows:</p>

<ol>
<li>Starts with &#8220;/&#8221;, look under Modules subdir in MarkLogic install</li>
<li>Starts with &#8220;/&#8221;, look under App Server root</li>
<li>Doesn&#8217;t start with &#8220;/&#8221;, look relative to location of referencing module</li>
<li>Contains scheme/network location (eg, &#8220;http://&#8221;), throw exception</li>
</ol>


<p>So, everything&#8217;s all well and good using leading &#8220;/&#8221; in the &#8220;at&#8221; expression until you want to reference the same code from multiple locations (really only a problem in local filesystem development thus far).  For Example:</p>

<ul>
<li>App Server 1 - This app server&#8217;s root is pointed to its own code.  Absolute paths work fine. Bam!</li>
<li>App Server 2 - This app server&#8217;s root is different.  It has its own code and also has a maven dependency declared on the code that&#8217;s currently being run on App Server 1.  App Server 1 code is a module that I&#8217;ve packaged up and sent to the maven repo, but developing locally, I don&#8217;t have a compile or package phase for running my app, so I create a symlink with the same name as the artifactId to where the code is that I want to reference.  To get my import statements that link App Server 2 to App Server 1 code to work, I have to add the artifactId at the front of the absolute path.  But, now the problem is the code within App Server 1, where it links to itself.  Because it uses the leading &#8220;/&#8221; (absolute), MarkLogic tries to resolve it under App Server root, which in this case is a different App Server entirely.</li>
</ul>


<p>So, am I stuck using relative paths at least inside of the App Server 1 code?</p>

<h2>Dreams</h2>

<p>All I want in an import statement is to declare to my language that I want to use code that is stored elsewhere.  Can&#8217;t we do that in fewer than 80 chars?  And couldn&#8217;t there be a really cool convention (over configuration), for developers like me whose fingers tire from writing ranting blog posts, that, for example, could derive a path to the .xqy file from the namespace that follows said convention?  Finally, I can&#8217;t help but think that there has to be an easier way for me to find and run bits of code from places besides my App Server root, even in local filesystem dev mode.</p>

<p>Help me, Obi-wan Kenobi, you&#8217;re my only hope.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Jake Trent</span></span>

      








  


<time datetime="2011-01-28T14:06:00-07:00" pubdate data-updated="true">Jan 28<span>th</span>, 2011</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/code/'>Code</a>, <a class='category' href='/blog/categories/marklogic/'>marklogic</a>, <a class='category' href='/blog/categories/maven/'>maven</a>, <a class='category' href='/blog/categories/xquery/'>xquery</a>
  
</span>


    </p>
    
      
    
    <p class="meta">
      
        <a class="prev-article-link" href="/post/jquery-ajax-json-django/" title="Previous Post: Jquery, Ajax, Json on Django">&laquo; Jquery, Ajax, Json on Django</a>
      
      
        <a class="next-article-link" href="/post/xdmp-login-love/" title="Next Post: Xdmp:Login Love">Xdmp:Login Love &raquo;</a>
      
    </p>
  </footer>
</article>

  <section class="comments">
    <h2 class="comments-title">Comments</h2>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

    </div>
  </div>
  <div class="footer-container">
    <footer class="main-footer" role="contentinfo"><div class="main-footer-logo"></div>
<ul class="main-footer-links-list">
  <li class="main-footer-links-item">
    <span class="main-footer-verbage">Content licensed</span> 2017 <a href="http://creativecommons.org/licenses/by/3.0/us/">CC 3.0 Attribution</a>
  </li>
  <li class="main-footer-links-item">
    <span class="main-footer-verbage">Authored by </span><a href="https://plus.google.com/115032056022257436849?rel=author">Jake Trent</a>
  </li>
  <li class="main-footer-links-item">
    <span class="main-footer-verbage">Subscribe to the </span><a href="/atom.xml">Feed</a>
  </li>
  <li class="main-footer-links-item main-footer-links-item-extra">
    <a href="/sitemap.xml">Sitemap</a>
  </li>
  <li class="main-footer-links-item main-footer-links-item-extra">
    <a href="https://github.com/jaketrent/jaketrent-blog/issues/new">Report a Bug</a>
  </li>
  <li class="main-footer-links-item main-footer-links-item-extra">
    <span class="main-footer-verbage">Chat on </span><a href="https://keybase.io/jaketrent">Keybase</a>
  </li>
  <li class="main-footer-links-item main-footer-links-item-extra">
    <span class="main-footer-verbage">Powered by </span><a href="http://octopress.org">Octopress</a>
  </li>
</ul>

</footer>
  </div>
  

<script type="text/javascript">
      var disqus_shortname = 'jaketrent';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://jaketrent.com/post/xquery-imports-marklogic/';
        var disqus_url = 'http://jaketrent.com/post/xquery-imports-marklogic/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





</body>
</html>
