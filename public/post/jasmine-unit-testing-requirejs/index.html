
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Jasmine Unit Testing with RequireJS - Jake Trent</title>

  <meta name="author" content="https://plus.google.com/115032056022257436849">
  
  <meta name="description" content="As more application logic gets pushed into the browser for client-heavy apps, the need for javascript testing increases. Lately, I've been doing some &hellip;">
  <meta name="keywords" content="javascript, nginx, unit-testing, requirejs, jasmine">
  <meta name="copyright" content="http://creativecommons.org/licenses/by/3.0/us/" />

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="Jasmine Unit Testing with RequireJS" />
  <meta property="og:type" content="article" />
  
  <meta property="og:url" content="http://jaketrent.com/post/jasmine-unit-testing-requirejs/" />
  <meta property="og:description" content="As more application logic gets pushed into the browser for client-heavy apps, the need for javascript testing increases. Lately, I've been doing some &hellip;" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Jasmine Unit Testing with RequireJS" />
  <meta name="twitter:description" content="As more application logic gets pushed into the browser for client-heavy apps, the need for javascript testing increases. Lately, I've been doing some &hellip;" />
  

  
  <link rel="canonical" href="http://jaketrent.com/post/jasmine-unit-testing-requirejs/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Jake Trent" type="application/atom+xml">
  <meta name="google-site-verification" content="uvx7BhaUTNz29nQgydsFPRsErfqYBhPEV_svnHvW7H0" />

<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-16224416-4']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <div class="container">
    <div class="sidebar">
      <nav class="main-nav" role="navigation"><ul class="main-nav-list">
  <li class="main-nav-item">
    <a class="main-nav-link" href="/">Blog</a>
  </li>
  <li class="main-nav-item">
    <a class="main-nav-link" href="/work">Work</a>
  </li>
  <li class="main-nav-item">
    <a class="main-nav-link" href="/books">Books</a>
  </li>
  <li class="main-nav-item">
    <a class="main-nav-link" href="https://github.com/jaketrent">Github</a>
  </li>
  <li class="main-nav-item">
    <a class="main-nav-link" href="http://www.linkedin.com/in/jaketrent">LinkedIn</a>
  </li>
</ul>
</nav>
      <article class="logo">
  <header class="logo-header">
    <h2 class="logo-title">
      <a class="logo-link" href="/">JakeTrent.com</a>
    </h2>
  </header>
</article>

    </div>
    <div class="content">
      <div>
<article class="entry entry-detail" role="article">
  
  <header>
    
      <h1 class="entry-title">Jasmine Unit Testing With RequireJS</h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-12-21T08:21:00-07:00" pubdate data-updated="true">Dec 21<span>st</span>, 2011</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>As more application logic gets pushed into the browser for client-heavy apps, the need for javascript testing increases.  Lately, I&#8217;ve been doing some Jasmine unit testing of an application that uses RequireJS.  Here are some general pointers and potential pitfalls to watch for.</p>

<!--more-->


<h2>Jasmine Standalone</h2>

<p>After messing with potentially running the tests with the Jasmine Maven plugin, inside NodeJS, and headless webkit, I came back to the simplest solution.  I came back because after much heartache, I just wanted something to work.  <a href="http://pivotal.github.com/jasmine/download.html">Jasmine standalone</a> has done the trick.</p>

<h2>Test Runner Setup</h2>

<p><a href="http://requirejs.org/docs/api.html#config">RequireJS paths</a> can be tricky.  For some reason, the trickiness seems to increase inside the testing environment.  To try and make relative pathing easier, I&#8217;ve included my test directory inside my app&#8217;s js directory, like so:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>js/
</span><span class='line'>  <span class="nb">test</span>/
</span><span class='line'>    tests/
</span><span class='line'>    runner.html
</span></code></pre></td></tr></table></div></figure>


<p>Jasmine standalone just uses a plain old HTML file for its runner.  My RequireJs Jasmine runner structure looks like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span class='line'><span class="nt">&lt;html&gt;</span>
</span><span class='line'><span class="nt">&lt;head&gt;</span>
</span><span class='line'>  <span class="nt">&lt;title&gt;</span>Spec Runner<span class="nt">&lt;/title&gt;</span>
</span><span class='line'>  <span class="c">&lt;!-- Jasmine lib / testing includes --&gt;</span>
</span><span class='line'>  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;shortcut icon&quot;</span> <span class="na">type=</span><span class="s">&quot;image/png&quot;</span> <span class="na">href=</span><span class="s">&quot;vendor/jasmine_favicon.png&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span> <span class="na">href=</span><span class="s">&quot;vendor/jasmine.css&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src=</span><span class="s">&quot;vendor/jasmine.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>  <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src=</span><span class="s">&quot;vendor/jasmine-html.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>  <span class="c">&lt;!-- ... --&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c">&lt;!-- global lib includes --&gt;</span>
</span><span class='line'>  <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src=</span><span class="s">&quot;../vendor/jquery.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>  <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src=</span><span class="s">&quot;../require.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>  <span class="c">&lt;!-- ... --&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// This is key!</span>
</span><span class='line'>    <span class="nx">require</span><span class="p">.</span><span class="nx">config</span><span class="p">({</span>
</span><span class='line'>      <span class="nx">baseUrl</span><span class="o">:</span> <span class="s1">&#39;../&#39;</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">require</span><span class="p">([</span>
</span><span class='line'>      <span class="s1">&#39;../test/tests/MyCode.spec&#39;</span>
</span><span class='line'>    <span class="p">],</span>
</span><span class='line'>      <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">jasmine</span><span class="p">.</span><span class="nx">getEnv</span><span class="p">().</span><span class="nx">addReporter</span><span class="p">(</span><span class="k">new</span> <span class="nx">jasmine</span><span class="p">.</span><span class="nx">TrivialReporter</span><span class="p">());</span>
</span><span class='line'>          <span class="nx">jasmine</span><span class="p">.</span><span class="nx">getEnv</span><span class="p">().</span><span class="nx">execute</span><span class="p">();</span>
</span><span class='line'>        <span class="p">});</span>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;/script&gt;</span>
</span><span class='line'><span class="nt">&lt;/head&gt;</span>
</span><span class='line'><span class="nt">&lt;body&gt;</span>
</span><span class='line'>  <span class="c">&lt;!-- empty on purpose --&gt;</span>
</span><span class='line'><span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Import everything that is global via the old-fashioned method &#8211; just a <code>&lt;script/&gt;</code> tag in the <code>&lt;head/&gt;</code>.  Then, write and import your specs as RequireJS modules, and just require them in your runner.</p>

<h2>A Runner Per main.js</h2>

<p>When I&#8217;m writing RequireJS modules in the app, I&#8217;m using relative paths.  These paths are always relative to the main module that uses these other require modules.  Thus, when you configure your runner, the <code>baseUrl</code> <em>needs</em> to point to the directory of the main module that in turn imports the modules under test.  And thus it follows that you&#8217;ll actually need a separate runner for each main module in your app.  So, if you&#8217;re a true single-page app, you&#8217;ll only have one module.  But, for example, in the app I&#8217;m currently dev&#8217;ing, we have a public main.js and an admin main.js, so we have a public-runner.html and an admin-runner.html.</p>

<p>This is only an issue if your app uses relative paths.  If you use absolute paths in your app modules, the new issue will be that you&#8217;ll have to be able to run your tests from the exact context from which your app usually runs.</p>

<h2>Require and Jquery</h2>

<p>Just a note:  Even though I use <code>require-jquery.js</code> in my app, I found that for some reason Jasmine didn&#8217;t appreciate that, and I had to import <code>jquery.js</code> and <code>require.js</code> separately.  If anyone knows why, I&#8217;d love to be enlightened.</p>

<h2>Run on an HTTP Server</h2>

<p>This probably goes without saying for anyone that has used require for some time, but since require dependencies are asynchronously loaded, you&#8217;re going to run into problems with cross domain policies in your local dev.  I use Chrome, and I immediately start seeing errors if I run from the filesystem:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>XMLHttpRequest cannot load file:///.../MyCodeDependency.js. Cross origin requests are only supported <span class="k">for </span>HTTP.
</span><span class='line'>Uncaught Error: NETWORK_ERR: XMLHttpRequest Exception 101
</span></code></pre></td></tr></table></div></figure>


<p>You could start Chrome with a flag to ignore this cross-domain policy, but I prefer to just spin up a little http server action with <a href="http://nginx.org/en/">nginx</a> and edit <code>/etc/nginx/sites-available/default</code> to point the server root at your projects <code>js/</code> directory and restart nginx (<code>sudo service nginx restart</code>).  Then get to your runner at something like <code>http://localhost/test/runner.html</code>.</p>

<h2>Require Test Fixtures</h2>

<p>Another reason to run your tests on an http server is for ease of importing text fixtures.  The way we&#8217;ve set up our runner, the baseUrl is configured to be the js root directory, which allows our app code to work unchanged, but now we&#8217;ve made it potentially harder for us to get to test dependencies that aren&#8217;t in the application code area.  This may just be my own ignorance of RequireJS shining through, but when I set <code>baseUrl: '../admin/'</code> for my <code>admin-runner.html</code> and try to import a test fixture w/ relative paths in the test, the paths are supremely messed up.  Thus, with this directory structure:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>js/
</span><span class='line'>  <span class="nb">test</span>/
</span><span class='line'>    tests/
</span><span class='line'>      admin/
</span><span class='line'>        TestNeedingFixture.spec.js
</span><span class='line'>      fixtures/
</span><span class='line'>        data.js
</span><span class='line'>    admin-runner.html
</span></code></pre></td></tr></table></div></figure>


<p>I&#8217;m forced to import with server absolute paths like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">define</span><span class="p">([</span><span class="s1">&#39;OtherAdminCode&#39;</span><span class="p">,</span> <span class="s1">&#39;/test/tests/fixtures/data.js&#39;</span><span class="p">],</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">OtherAdminCode</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;AdminCode&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">it</span> <span class="p">(</span><span class="s1">&#39;is awesome&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">expect</span><span class="p">(</span><span class="nx">somethingWithData</span><span class="p">).</span><span class="nx">toBeAwesome</span><span class="p">();</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>So, again, if I wasn&#8217;t running tests on an Http server, this wouldn&#8217;t work.</p>

<h2>Secrets of the Fire Swamp</h2>

<p>RequireJS has made my heavy-Javascript app dev much more enjoyable.  I don&#8217;t have to deal with massive, monolithic js files.  Instead, I have lots of little cohesive files, and I have a nice tool that helps me import them where needed.  RequireJS does still have a little bit of mystique for me, however.  The paths can be hit and miss.  Once I find a pattern that seems to work, I stick to it like glue.  And that usually works for me, but as we&#8217;ve seen, once we switch contexts (like into the context of the jasmine test runner), those paths may again be in question.  That&#8217;s why, as we&#8217;ve seen, you should do the wacking one-off pathing on the test side of things so your app code can remain clean and unchanged.  Eat, test, and be merry.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Jake Trent</span></span>

      








  


<time datetime="2011-12-21T08:21:00-07:00" pubdate data-updated="true">Dec 21<span>st</span>, 2011</time>
      


    </p>
    
      <div class="sharing"></div>

    
    <p class="meta">
      
        <a class="prev-article-link" href="/post/backbone-inheritance/" title="Previous Post: Backbone Inheritance">&laquo; Backbone Inheritance</a>
      
      
        <a class="next-article-link" href="/post/stored-procedure-spring-jdbc/" title="Next Post: Stored Procedures in Spring Jdbc">Stored Procedures in Spring Jdbc &raquo;</a>
      
    </p>
  </footer>
</article>

  <section class="comments">
    <h2 class="comments-title">Comments</h2>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

    </div>
  </div>
  <div class="container">
    <footer class="main-footer" role="contentinfo"><p>
  <a href="http://creativecommons.org/licenses/by/3.0/us/">CC 3.0 Attribution</a> 2014 -
  <a href="https://plus.google.com/115032056022257436849?rel=author">Jake Trent</a> -
  <a href="/atom.xml">Feed</a>
  <span class="main-footer-extras">-
    <a href="/sitemap.xml">Sitemap</a> -
    <a href="https://github.com/jaketrent/jaketrent-blog/issues">Report a Bug</a> -
    <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
  </span>
</p>

</footer>
  </div>
  

<script type="text/javascript">
      var disqus_shortname = 'jaketrent';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://jaketrent.com/post/jasmine-unit-testing-requirejs/';
        var disqus_url = 'http://jaketrent.com/post/jasmine-unit-testing-requirejs/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





</body>
</html>
