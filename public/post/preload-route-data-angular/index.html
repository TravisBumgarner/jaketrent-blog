
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Preload Route Data in Angular - Jake Trent</title>
  <meta name="author" content="Jake Trent">

  
  <meta name="description" content="It's sometimes useful to preload/resolve data previous to your Angular view being displayed. Such was the case recently for our current user object.">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://jaketrent.com/post/preload-route-data-angular/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Jake Trent" type="application/atom+xml">
  <meta name="google-site-verification" content="uvx7BhaUTNz29nQgydsFPRsErfqYBhPEV_svnHvW7H0" />

<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-16224416-4']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1 class="title"><a href="/">Jake Trent</a></h1>
  <div class="desc">
    
      <h2>Power Ballad Coding</h2>
    
  </div>
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:jaketrent.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/blog/categories/code/">Code</a></li>
  <li><a href="/blog/categories/design/">Design</a></li>
  <li><a href="/blog/categories/productivity/">Productivity</a></li>
  <li><a href="/blog/categories/review/">Reviews</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Preload Route Data in Angular</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-08-13T08:10:00-06:00" pubdate data-updated="true">Aug 13<span>th</span>, 2013</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>It&#8217;s sometimes useful to be able to preload or resolve data previous to an Angular view being displayed.  Such was the case recently for our current user object.  It simplified a lot of things in the app to have the guarantee of a loaded current user previous to displaying pages.  The Angular router has a great mechanism built in to do just this sort of thing, called <code>resolve</code>.</p>

<p><img src="http://i.imgur.com/wVBKD.png" alt="Angularjs" /></p>

<!--more-->


<h2>Current User</h2>

<p>For the example, our current user object is super simple.  Just pretend that it holds all of the relevant details of a user.  These details are useful for displaying various things in the app that need the context of who the currently logged-in user is.</p>

<figure class='code'><figcaption><span>current-user.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'>  <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s">&#39;app.services&#39;</span><span class="p">).</span><span class="nx">factory</span> <span class="s">&#39;CurrentUser&#39;</span><span class="p">,</span> <span class="nf">($http, User) -&gt;</span>
</span><span class='line'>    <span class="k">class</span> <span class="nx">CurrentUser</span> <span class="k">extends</span> <span class="nx">User</span>
</span><span class='line'>      <span class="nv">fetch: </span><span class="o">-&gt;</span>
</span><span class='line'>        <span class="c1"># do $http things to request user data</span>
</span><span class='line'>      <span class="nv">isLoaded: </span><span class="o">-&gt;</span>
</span><span class='line'>        <span class="c1"># true if fetched and ready to go</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">new</span> <span class="nx">CurrentUser</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note that for our app there is just one <code>CurrentUser</code> object, a singleton, because we return a single instance from our factory, not a class.</p>

<h2>Router</h2>

<p>The Angular router is used for client-side routing of urls.  Our angular app is called <code>app</code>.  We setup some angular submodules to hold config, services, and controllers.</p>

<p>Let&#8217;s say that we have a home page and a profile page for our example.</p>

<p>Each route can be configured with a <code>resolve</code> object.  The key of that object is the name of a local variable and the value is a function which returns a promise.  The resolution value of the promise is the data you want before the route executes.After all the promises are resolved, the route is free to switch and execute.  Until then, each unresolved promise will block the route from executing.</p>

<figure class='code'><figcaption><span>app.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span> <span class="s">&#39;app.config&#39;</span><span class="p">,</span> <span class="p">[]</span>
</span><span class='line'><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span> <span class="s">&#39;app.services&#39;</span><span class="p">,</span> <span class="p">[]</span>
</span><span class='line'><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span> <span class="s">&#39;app.controllers&#39;</span><span class="p">,</span> <span class="p">[]</span>
</span><span class='line'>
</span><span class='line'><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s">&#39;app&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;app.config&#39;</span><span class="p">,</span> <span class="s">&#39;app.services&#39;</span><span class="p">,</span> <span class="s">&#39;app.controllers&#39;</span><span class="p">])</span>
</span><span class='line'>
</span><span class='line'><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s">&#39;app&#39;</span><span class="p">).</span><span class="nx">config</span> <span class="nf">($routeProvider, $locationProvider, resolves) -&gt;</span>
</span><span class='line'>  <span class="nx">$locationProvider</span><span class="p">.</span><span class="nx">html5Mode</span> <span class="kc">true</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">$routeProvider</span>
</span><span class='line'>    <span class="p">.</span><span class="k">when</span> <span class="s">&#39;/&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="nv">controller: </span><span class="s">&#39;HomeCtrl&#39;</span>
</span><span class='line'>      <span class="nv">templateUrl: </span><span class="s">&#39;/templates/home.html&#39;</span>
</span><span class='line'>    <span class="p">.</span><span class="k">when</span> <span class="s">&#39;/profile&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="nv">controller: </span><span class="s">&#39;ProfileCtrl&#39;</span>
</span><span class='line'>      <span class="nv">templateUrl: </span><span class="s">&#39;/templates/profile.html&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s">&#39;app&#39;</span><span class="p">).</span><span class="nx">run</span> <span class="nf">($route, resolves)-&gt;</span>
</span><span class='line'>  <span class="k">for</span> <span class="nx">r</span> <span class="k">in</span> <span class="nx">$route</span><span class="p">.</span><span class="nx">routes</span>
</span><span class='line'>    <span class="nx">r</span><span class="p">.</span><span class="nx">resolve</span> <span class="o">?=</span> <span class="p">{}</span>
</span><span class='line'>    <span class="nv">r.resolve.CurrentUser = </span><span class="nx">resolves</span><span class="p">.</span><span class="nx">getCurrentUser</span>
</span></code></pre></td></tr></table></div></figure>


<p>The <code>run</code> method is essentially the Angular app&#8217;s main method, starting the program.  I want to ensure the current user is loaded for each route.  In this case, instead of putting a <code>resolve</code> config on each route, I&#8217;m looping through all routes after their initial definition and adding the <code>CurrentUser: resolves.getCurrentUser</code> config.</p>

<h2>Resolve Function</h2>

<p>In our resolve function we setup our own promise via the <code>$q</code> service.  We check to see if our singleton <code>CurrentUser</code> is already loaded.  If it&#8217;s not, we fetch it.  If it has been fetched once already, we resolve the promise with the value that&#8217;s already available.</p>

<figure class='code'><figcaption><span>resolves.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s">&#39;app.config&#39;</span><span class="p">).</span><span class="nx">constant</span> <span class="s">&#39;resolves&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">getCurrentUser: </span><span class="nf">($q, CurrentUser) -&gt;</span>
</span><span class='line'>    <span class="nv">defer = </span><span class="nx">$q</span><span class="p">.</span><span class="nx">defer</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="o">not</span> <span class="nx">CurrentUser</span><span class="p">.</span><span class="nx">isLoaded</span><span class="p">()</span>
</span><span class='line'>      <span class="nv">req = </span><span class="nx">CurrentUser</span><span class="p">.</span><span class="nx">fetch</span><span class="p">()</span>
</span><span class='line'>      <span class="nx">req</span><span class="p">.</span><span class="nx">success</span> <span class="o">-&gt;</span> <span class="nx">defer</span><span class="p">.</span><span class="nx">resolve</span> <span class="nx">CurrentUser</span>
</span><span class='line'>      <span class="nx">req</span><span class="p">.</span><span class="nx">error</span> <span class="o">-&gt;</span> <span class="nx">defer</span><span class="p">.</span><span class="nx">reject</span><span class="p">()</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>      <span class="nx">defer</span><span class="p">.</span><span class="nx">resolve</span> <span class="nx">CurrentUser</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">defer</span><span class="p">.</span><span class="nx">promise</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Application Controller</h2>

<p>Now that we have the <code>CurrentUser</code> guaranteed to be resolved (fetched and returned) by the time we enter all routes, we need to grab the value of <code>CurrentUser</code> and put it in <code>$scope</code> where our program would normally pick up and start using variables.</p>

<figure class='code'><figcaption><span>app-ctrl.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s">&#39;app.controllers&#39;</span><span class="p">).</span><span class="nx">controller</span> <span class="s">&#39;AppCtrl&#39;</span><span class="p">,</span> <span class="nf">($scope) -&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">$scope</span><span class="p">.</span><span class="nx">$on</span> <span class="s">&#39;$routeChangeSuccess&#39;</span><span class="p">,</span> <span class="nf">(next, current) -&gt;</span>
</span><span class='line'>    <span class="k">if</span> <span class="nx">current</span><span class="p">.</span><span class="nx">locals</span><span class="p">.</span><span class="nx">CurrentUser</span><span class="o">?</span>
</span><span class='line'>      <span class="nv">$scope.currentUser = </span><span class="nx">current</span><span class="p">.</span><span class="nx">locals</span><span class="p">.</span><span class="nx">CurrentUser</span>
</span></code></pre></td></tr></table></div></figure>


<p>We listen the Angular-provided event when a route is successfully entered: <code>$routeChangeSuccess</code>.  The value we care about is available on the <code>current</code> route&#8217;s <code>locals</code> object, placed there magically by the resolve function.</p>

<h2>When to Use</h2>

<p>There are a few bits to piece together to make this happen.  It might be simpler than other solutions or make more sense for you in your app if you need something(s) loaded previous to executing on a route.</p>

<p>I would definitely use this feature judiciously, as it seems to eat away at one of the advantages of a client-side app in the first place: asynchronous loading.  We&#8217;8re blocking the whole app from going forward when we&#8217;re in the process of resolving.  That boundary used to be on the edge of the server, building up the page before it was servable to the client.  Now, on a web client, we have multiple requests that can happen in parallel and we can render bits as they&#8217;re available &#8211; important bits first and so on.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Jake Trent</span></span>

      








  


<time datetime="2013-08-13T08:10:00-06:00" pubdate data-updated="true">Aug 13<span>th</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/code/'>Code</a>, <a class='category' href='/blog/categories/angularjs/'>angularjs</a>, <a class='category' href='/blog/categories/js/'>js</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://jaketrent.com/post/preload-route-data-angular/" data-via="" data-counturl="http://jaketrent.com/post/preload-route-data-angular/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/post/how-marklogic-made-me-better-programmer/" title="Previous Post: How MarkLogic Made Me a Better Programmer">&laquo; How MarkLogic Made Me a Better Programmer</a>
      
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <ul id="social">
    <li><a class="social social-github" href="http://github.com/jaketrent" title="Github" class="first">Github</a></li>
    <li><a class="social social-twitter" href="http://twitter.com/jaketrent" title="Twitter">Twitter</a></li>
    <li><a class="social social-linkedin" href="http://linkedin.com/in/jaketrent" title="LinkedIn">LinkedIn</a></li>
    <li><a class="social social-googleplus" href="https://plus.google.com/115032056022257436849?rel=author" title="Google Plus">Google Plus</a></li>
    <li><a class="social social-rss" href="/atom.xml" title="RSS">RSS</a></li>
  </ul>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/post/preload-route-data-angular/">Preload Route Data in Angular</a>
      </li>
    
      <li class="post">
        <a href="/post/how-marklogic-made-me-better-programmer/">How MarkLogic Made Me a Better Programmer</a>
      </li>
    
      <li class="post">
        <a href="/post/ember-dynamic-classes/">Ember Dynamic Classes</a>
      </li>
    
      <li class="post">
        <a href="/post/style-file-input/">Style File Input</a>
      </li>
    
      <li class="post">
        <a href="/post/so-good-they-cant-ignore-you/">So Good They Can't Ignore You</a>
      </li>
    
  </ul>
</section>




<section class="googleplus googleplus-hidden">
  <h1>
    <a href="https://plus.google.com/115032056022257436849?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Jake Trent -
  <a href="/blog/archives">Archives</a> -
  <a href="/atom.xml">Feed</a> -
  <a href="/sitemap.xml">Sitemap</a> -
  <a href="https://github.com/jaketrent/jaketrent-blog/issues">Report a Bug</a> -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'jaketrent';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://jaketrent.com/post/preload-route-data-angular/';
        var disqus_url = 'http://jaketrent.com/post/preload-route-data-angular/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
