
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>An Environment-specific Grunt Build - Jake Trent</title>
  <meta name="author" content="Jake Trent">

  
  <meta name="description" content="Does your project use GruntJs as a build tool? Have you ever to customize your build to the environment you&#8217;re deploying to? It&#8217;s handy &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://jaketrent.com/post/an-environment-specific-grunt-build/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Jake Trent" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Jake Trent</a></h1>
  
    <h2>Coding a Power Ballad</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:jaketrent.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">An Environment-specific Grunt Build</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-10-28T17:03:00-06:00" pubdate data-updated="true">Oct 28<span>th</span>, 2012</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>Does your project use GruntJs as a build tool?  Have you ever to customize your build to the environment you&#8217;re deploying to?  It&#8217;s handy to be able to specify certain commands to run or keep from running.  It&#8217;s likely essential to be able to change environment-specific variables via Grunt.  It&#8217;s not bad.  Most of the leg-work has been done by earlier generations &#8211; that is, if Grunt is old enough to have earlier generations yet.</p>

<p><img src="http://i.imgur.com/4773D.jpg" alt="Grunt JS" /></p>

<!--more-->


<h2>Grunt-context Plugin</h2>

<p>Jonathan Barnett has created a nice little grunt plugin that called <a href="https://npmjs.org/package/grunt-context">grunt-context</a>.  With grunt-context, you can easily specify environment-specific overrides to your grunt tasks.  The <a href="https://github.com/indieisaconcept/grunt-context">github page for grunt-context</a> can provide you with the basics on how to configure your grunt build.</p>

<p>Let&#8217;s try a concrete config.  Let&#8217;s say that I want to run the <a href="http://jaketrent.com/post/run-requirejs-with-gruntjs/">RequireJs optimizer</a> only when I deploy to my test environment or to production but not for my local build.</p>

<p>First, install the plugin:</p>

<pre><code>npm install grunt-context
</code></pre>

<p>Second, fix up your grunt.js file to include:</p>

<pre><code>module.exports = function(grunt) {
  grunt.initConfig({
    /* ... */
    // 'requirejs' task REQUIRED to be listed first at root level config
    requirejs: {
      compile: {
        options: {
          // !! all app.build.js standard requirejs options here
        }
      }
    },
    context: {
      // !! list each of your desired environments/contexts here
      local: {
        tasks: {
          // !! 'requirejs' task left out
          default: 'lint test'
        }
      },
      test: {
        tasks: {
          // !! put 'requirejs' in default task list
          default: 'requirejs lint test'
        }
      },
      prod: {
        //  !! re-list the 'requirejs' task to override its behavior for this context
        requirejs: {
          compile: {
            options: {
              // !! override the standard requirejs options for something
              // special in prod build only
            }
          }
        },
        tasks: {
          default: 'requirejs lint test'
        }
      }
    }
  });

  // !! load the plugin
  grunt.loadNpmTasks('grunt-context');
};
</code></pre>

<p>Finally, run the grunt build and target a specific context.  If you want to build locally and not have requirejs run, type:</p>

<pre><code>grunt context:local
</code></pre>

<p>If you want to build for test, where requirejs will optimize, type:</p>

<pre><code>grunt context:test
</code></pre>

<p>Notice in the &#8216;prod&#8217; context that I also can override the actual variables for running the requirejs build.  So, it will not only run things or not run things, but you can run tasks in specific ways per environment.</p>

<h2>The Cons</h2>

<p>The plugin works well most of the time, but I haven&#8217;t had a stellar performance in all cases.  It could be that I&#8217;m unknowingly using it wrong.  I&#8217;ve tried many different methods to try and work out some of my issues with it.</p>

<p>For instance, I cannot get it to override functions set to the <a href="https://npmjs.org/package/grunt-exec">grunt-exec</a> <code>command</code> attribute.  It will override string commands just fine, but it has problems with functions.  This could be because it has to assemble task lists for execution within a context and calculate overrides.  My guess is that the implementation may just be lacking in this area.</p>

<h2>Best Option So Far</h2>

<p>For environment-specific grunt builds, <a href="https://npmjs.org/package/grunt-context">grunt-context</a> is the best solution I&#8217;ve found so far.  It&#8217;s not the best, but it usually gets the job done.  I&#8217;ve bent it to my will thus far.</p>

<p>What have you found that works well for environment-specific JavaScript builds?</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Jake Trent</span></span>

      








  


<time datetime="2012-10-28T17:03:00-06:00" pubdate data-updated="true">Oct 28<span>th</span>, 2012</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/code/'>Code</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://jaketrent.com/post/an-environment-specific-grunt-build/" data-via="jaketrent" data-counturl="http://jaketrent.com/post/an-environment-specific-grunt-build/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/post/run-requirejs-with-gruntjs/" title="Previous Post: Run RequireJs with GruntJs">&laquo; Run RequireJs with GruntJs</a>
      
      
        <a class="basic-alignment right" href="/post/test-requirejs-testacular/" title="Next Post: Test RequireJs Code in Testacular">Test RequireJs Code in Testacular &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/post/responsive-table-with-scrolling/">Responsive Table with Scrolling</a>
      </li>
    
      <li class="post">
        <a href="/post/grunt-and-testacular/">Grunt and Testacular</a>
      </li>
    
      <li class="post">
        <a href="/post/test-requirejs-testacular/">Test RequireJs Code in Testacular</a>
      </li>
    
      <li class="post">
        <a href="/post/an-environment-specific-grunt-build/">An Environment-specific Grunt Build</a>
      </li>
    
      <li class="post">
        <a href="/post/run-requirejs-with-gruntjs/">Run RequireJs with GruntJs</a>
      </li>
    
  </ul>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("jaketrent", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/jaketrent" class="twitter-follow-button" data-show-count="false">Follow @jaketrent</a>
  
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Jake Trent -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'jaketrent';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://jaketrent.com/post/an-environment-specific-grunt-build/';
        var disqus_url = 'http://jaketrent.com/post/an-environment-specific-grunt-build/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
