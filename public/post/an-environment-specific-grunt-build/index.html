
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>An Environment-specific Grunt Build - Jake Trent</title>
  <meta name="author" content="https://plus.google.com/115032056022257436849">

  
  <meta name="description" content="Does your project use GruntJs as a build tool? Have you ever to customize your build to the environment you&#8217;re deploying to? It&#8217;s handy &hellip;">
  

  <meta name="copyright" content="http://creativecommons.org/licenses/by/3.0/us/" />

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="An Environment-specific Grunt Build" />
  <meta property="og:type" content="article" />
  
  <meta property="og:url" content="http://jaketrent.com/post/an-environment-specific-grunt-build/" />
  <meta property="og:description" content="Does your project use GruntJs as a build tool? Have you ever to customize your build to the environment you&#8217;re deploying to? It&#8217;s handy &hellip;" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="An Environment-specific Grunt Build" />
  <meta name="twitter:description" content="Does your project use GruntJs as a build tool? Have you ever to customize your build to the environment you&#8217;re deploying to? It&#8217;s handy &hellip;" />
  

  
  <link rel="canonical" href="http://jaketrent.com/post/an-environment-specific-grunt-build/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Jake Trent" type="application/atom+xml">
  <meta name="google-site-verification" content="uvx7BhaUTNz29nQgydsFPRsErfqYBhPEV_svnHvW7H0" />

<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-16224416-4']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <div class="container">
    <div class="sidebar">
      <nav class="main-nav" role="navigation"><ul class="main-nav-list">
  <li class="main-nav-item">
    <a class="main-nav-link" href="/">Blog</a>
  </li>
  <li class="main-nav-item">
    <a class="main-nav-link" href="http://builtbyjake.com/">Work</a>
  </li>
  <li class="main-nav-item">
    <a class="main-nav-link" href="https://github.com/jaketrent">Github</a>
  </li>
  <li class="main-nav-item">
    <a class="main-nav-link" href="http://www.linkedin.com/in/jaketrent">LinkedIn</a>
  </li>
</ul>
</nav>
      <article class="logo">
  <header class="logo-header">
    <h2 class="logo-title">
      <a class="logo-link" href="/">JakeTrent.com</a>
    </h2>
  </header>
</article>

    </div>
    <div class="content">
      <div>
<article class="entry entry-detail" role="article">
  
  <header>
    
      <h1 class="entry-title">An Environment-specific Grunt Build</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-10-28T17:03:00-06:00" pubdate data-updated="true">Oct 28<span>th</span>, 2012</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>Does your project use GruntJs as a build tool?  Have you ever to customize your build to the environment you&#8217;re deploying to?  It&#8217;s handy to be able to specify certain commands to run or keep from running.  It&#8217;s likely essential to be able to change environment-specific variables via Grunt.  It&#8217;s not bad.  Most of the leg-work has been done by earlier generations &#8211; that is, if Grunt is old enough to have earlier generations yet.</p>

<p><img src="http://i.imgur.com/4773D.jpg" alt="Grunt JS" /></p>

<!--more-->


<h2>Grunt-context Plugin</h2>

<p>Jonathan Barnett has created a nice little grunt plugin that called <a href="https://npmjs.org/package/grunt-context">grunt-context</a>.  With grunt-context, you can easily specify environment-specific overrides to your grunt tasks.  The <a href="https://github.com/indieisaconcept/grunt-context">github page for grunt-context</a> can provide you with the basics on how to configure your grunt build.</p>

<p>Let&#8217;s try a concrete config.  Let&#8217;s say that I want to run the <a href="http://jaketrent.com/post/run-requirejs-with-gruntjs/">RequireJs optimizer</a> only when I deploy to my test environment or to production but not for my local build.</p>

<p>First, install the plugin:</p>

<pre><code>npm install grunt-context
</code></pre>

<p>Second, fix up your grunt.js file to include:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">grunt</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">grunt</span><span class="p">.</span><span class="nx">initConfig</span><span class="p">({</span>
</span><span class='line'>    <span class="cm">/* ... */</span>
</span><span class='line'>    <span class="c1">// &#39;requirejs&#39; task REQUIRED to be listed first at root level config</span>
</span><span class='line'>    <span class="nx">requirejs</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">compile</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>          <span class="c1">// !! all app.build.js standard requirejs options here</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="nx">context</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>      <span class="c1">// !! list each of your desired environments/contexts here</span>
</span><span class='line'>      <span class="nx">local</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">tasks</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>          <span class="c1">// !! &#39;requirejs&#39; task left out</span>
</span><span class='line'>          <span class="k">default</span><span class="o">:</span> <span class="s1">&#39;lint test&#39;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">},</span>
</span><span class='line'>      <span class="nx">test</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">tasks</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>          <span class="c1">// !! put &#39;requirejs&#39; in default task list</span>
</span><span class='line'>          <span class="k">default</span><span class="o">:</span> <span class="s1">&#39;requirejs lint test&#39;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">},</span>
</span><span class='line'>      <span class="nx">prod</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">//  !! re-list the &#39;requirejs&#39; task to override its behavior for this context</span>
</span><span class='line'>        <span class="nx">requirejs</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">compile</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>              <span class="c1">// !! override the standard requirejs options for something</span>
</span><span class='line'>              <span class="c1">// special in prod build only</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="nx">tasks</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">default</span><span class="o">:</span> <span class="s1">&#39;requirejs lint test&#39;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// !! load the plugin</span>
</span><span class='line'>  <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span><span class="p">(</span><span class="s1">&#39;grunt-context&#39;</span><span class="p">);</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>Finally, run the grunt build and target a specific context.  If you want to build locally and not have requirejs run, type:</p>

<pre><code>grunt context:local
</code></pre>

<p>If you want to build for test, where requirejs will optimize, type:</p>

<pre><code>grunt context:test
</code></pre>

<p>Notice in the &#8216;prod&#8217; context that I also can override the actual variables for running the requirejs build.  So, it will not only run things or not run things, but you can run tasks in specific ways per environment.</p>

<h2>The Cons</h2>

<p>The plugin works well most of the time, but I haven&#8217;t had a stellar performance in all cases.  It could be that I&#8217;m unknowingly using it wrong.  I&#8217;ve tried many different methods to try and work out some of my issues with it.</p>

<p>For instance, I cannot get it to override functions set to the <a href="https://npmjs.org/package/grunt-exec">grunt-exec</a> <code>command</code> attribute.  It will override string commands just fine, but it has problems with functions.  This could be because it has to assemble task lists for execution within a context and calculate overrides.  My guess is that the implementation may just be lacking in this area.</p>

<h2>Best Option So Far</h2>

<p>For environment-specific grunt builds, <a href="https://npmjs.org/package/grunt-context">grunt-context</a> is the best solution I&#8217;ve found so far.  It&#8217;s not the best, but it usually gets the job done.  I&#8217;ve bent it to my will thus far.</p>

<p>What have you found that works well for environment-specific JavaScript builds?</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Jake Trent</span></span>

      








  


<time datetime="2012-10-28T17:03:00-06:00" pubdate data-updated="true">Oct 28<span>th</span>, 2012</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/code/'>Code</a>, <a class='category' href='/blog/categories/grunt/'>grunt</a>, <a class='category' href='/blog/categories/js/'>js</a>
  
</span>


    </p>
    
      <div class="sharing"></div>

    
    <p class="meta">
      
        <a class="prev-article-link" href="/post/run-requirejs-with-gruntjs/" title="Previous Post: Run RequireJs with GruntJs">&laquo; Run RequireJs with GruntJs</a>
      
      
        <a class="next-article-link" href="/post/test-requirejs-testacular/" title="Next Post: Test RequireJs Code in Testacular">Test RequireJs Code in Testacular &raquo;</a>
      
    </p>
  </footer>
</article>

  <section class="comments">
    <h2 class="comments-title">Comments</h2>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

    </div>
  </div>
  <div class="container">
    <footer class="main-footer" role="contentinfo"><p>
  <a href="http://creativecommons.org/licenses/by/3.0/us/">CC 3.0 Attribution</a> 2014 -
  <a href="https://plus.google.com/115032056022257436849?rel=author">Jake Trent</a> -
  <a href="/atom.xml">Feed</a>
  <span class="main-footer-extras">-
    <a href="/sitemap.xml">Sitemap</a> -
    <a href="https://github.com/jaketrent/jaketrent-blog/issues">Report a Bug</a> -
    <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
  </span>
</p>

</footer>
  </div>
  

<script type="text/javascript">
      var disqus_shortname = 'jaketrent';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://jaketrent.com/post/an-environment-specific-grunt-build/';
        var disqus_url = 'http://jaketrent.com/post/an-environment-specific-grunt-build/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





</body>
</html>
