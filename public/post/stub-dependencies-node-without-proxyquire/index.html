
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Stub Dependencies in Node Without Proxyquire - Jake Trent</title>

  <meta name="author" content="https://plus.google.com/115032056022257436849">
  
  <meta name="description" content="How to stub your own dependencies in node without using a library like proxyquire">
  <meta name="keywords" content="js, node, stub, spy, unit testing, proxyquire, mock">
  <meta name="copyright" content="http://creativecommons.org/licenses/by/3.0/us/" />

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="Stub Dependencies in Node Without Proxyquire" />
  <meta property="og:type" content="article" />
  <meta property="og:image" content="http://i.imgur.com/1arT8Ho.jpg" />
  <meta property="og:url" content="http://jaketrent.com/post/stub-dependencies-node-without-proxyquire/" />
  <meta property="og:description" content="How to stub your own dependencies in node without using a library like proxyquire" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Stub Dependencies in Node Without Proxyquire" />
  <meta name="twitter:description" content="How to stub your own dependencies in node without using a library like proxyquire" />
  <meta name="twitter:image" content="http://i.imgur.com/1arT8Ho.jpg" />

  
  <link rel="canonical" href="http://jaketrent.com/post/stub-dependencies-node-without-proxyquire/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Jake Trent" type="application/atom+xml">
  <meta name="google-site-verification" content="uvx7BhaUTNz29nQgydsFPRsErfqYBhPEV_svnHvW7H0" />

<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-16224416-4']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <div class="container">
    <div class="sidebar">
      <section class="logo">
  <header class="logo-header">
    <h2 class="logo-title">
      <a class="logo-link" href="/">
        <span class="logo-img"></span>
      </a>
    </h2>
  </header>
</section>

      <nav class="main-nav" role="navigation"><ul class="main-nav-list">
  <li class="main-nav-item">
    <a class="main-nav-link" href="/">Blog</a>
  </li>
  <li class="main-nav-item">
    <a class="main-nav-link" href="/work">Work</a>
  </li>
  <li class="main-nav-item">
    <a class="main-nav-link" href="https://books.jaketrent.com">Books</a>
  </li>
  <li class="main-nav-item">
    <a class="main-nav-link" href="https://github.com/jaketrent">Github</a>
  </li>
  <li class="main-nav-item">
    <a class="main-nav-link" href="http://www.linkedin.com/in/jaketrent">LinkedIn</a>
  </li>
</ul>
</nav>
    </div>
    <div class="content">
      <div>
<article class="entry entry-detail" role="article">
  
  <header>
    
      <h1 class="entry-title">Stub Dependencies in Node Without Proxyquire</h1>
    
    
      <p class="meta">
        








  


<time datetime="2016-09-29T06:30:00-06:00" pubdate data-updated="true">Sep 29<span>th</span>, 2016</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>When testing a unit, often you&#8217;ll want to stub out that unit&#8217;s dependencies.  Some libraries will help you do this.  But you can do it with plain JavaScript, and it works quite well.</p>

<p><img src="http://i.imgur.com/1arT8Ho.jpg" alt="nodejs testing" /></p>

<!--more-->


<h2>Stubbing Dependencies</h2>

<p>We&#8217;re unit testing a module in Node.  That unit has dependencies on some other sub-unit.  For our example, these units are modules. The subject under test is <code>prep-for-fight.js</code>.  It has a dependency on <code>eat-corn.js</code>.  We want to eventually stub out <code>eat-corn.js</code> within our unit test for <code>prep-for-fight.js</code>.</p>

<figure class='code'><figcaption><span>prep-for-fight.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kr">const</span> <span class="nx">eatCorn</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./eat-corn&#39;</span><span class="p">)</span>
</span><span class='line'><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">prepForFight</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="kr">const</span> <span class="nx">nutrients</span> <span class="o">=</span> <span class="nx">eatCorn</span><span class="p">()</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nx">nutrients</span> <span class="o">&gt;</span> <span class="nx">NUTRIENT_LEVELS</span><span class="p">.</span><span class="nx">EAGLE_EMPOWERMENT</span><span class="p">)</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">{</span> <span class="nx">hasCape</span><span class="o">:</span> <span class="nx">donHomemadeCape</span><span class="p">()</span> <span class="p">}</span>
</span><span class='line'>  <span class="c1">// ...</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>A <a href="/post/sinon-spies-vs-stubs/">stub</a> is a testing fake that you create in place of the real thing.  While testing our module <code>prepForFight</code>, we&#8217;ll stub out the sub-unit module <code>eatCorn</code>.  That module is tested elsewhere in another unit test.  We don&#8217;t want to conflate the two tests, coupling them strongly together.  This is because if the sub-unit&#8217;s implementation changes, we don&#8217;t want to have to change our current unit&#8217;s test.</p>

<p>The tradeoff is that we are going to couple our <code>prepForFight</code> unit test to the implementation of that module.  This is generally known as white box testing, where we care about the internal implementation of our source code within our tests.  If we did the opposite, and treated <code>prepForFight</code> as a black box and just tested its final output, there really is no need to stub anything or ever care about implementation as long as <code>prepForFight</code> continues to do its job.  For today&#8217;s example, we&#8217;ll choose to stub so that we can have a more isolated unit and focused test, drawing our unit boundaries strictly around code that exists in <code>prepForFight</code> proper.</p>

<h2>Stubbing Libraries</h2>

<p>There are libraries that help us stub.  Since we have a <code>require</code>d module for <code>eat-corn.js</code>, there is one in particular that would do well for us called <a href="https://github.com/thlorenz/proxyquire">proxyquire</a>.  It allows targeting the <code>./eat-corn.js</code> import path and replacing it with your own module at test runtime.  With a couple caveats, it usually works quite well.  We&#8217;re going to <em>not</em> use it and see how we fare.</p>

<h2>Stub by Passing the Dependency</h2>

<p>An easy way to get a dependency into <code>prepForFight</code> is to pass it as a function argument.  The rewrite might look like this:</p>

<figure class='code'><figcaption><span>prep-for-fight.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">prepForFight</span><span class="p">(</span><span class="nx">eatCorn</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kr">const</span> <span class="nx">nutrients</span> <span class="o">=</span> <span class="nx">eatCorn</span><span class="p">()</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nx">nutrients</span> <span class="o">&gt;</span> <span class="nx">NUTRIENT_LEVELS</span><span class="p">.</span><span class="nx">EAGLE_EMPOWERMENT</span><span class="p">)</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">{</span> <span class="nx">hasCape</span><span class="o">:</span> <span class="nx">donHomemadeCape</span><span class="p">()</span> <span class="p">}</span>
</span><span class='line'>  <span class="c1">// ...</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we have no <code>require</code> statement, and <code>prepForFight</code> gets the dependency it needs.  Given this implementation, we can exercise our two code paths in our test:</p>

<figure class='code'><figcaption><span>prep-for-fight.spec.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kr">const</span> <span class="nx">test</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;ava&#39;</span><span class="p">)</span> <span class="c1">// or whatevs</span>
</span><span class='line'>
</span><span class='line'><span class="kr">const</span> <span class="nx">subject</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./prep-for-fight&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;many nutrients dons cape&#39;</span><span class="p">,</span> <span class="nx">t</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">function</span> <span class="nx">eatCornStub</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">NUTRIENT_LEVELS</span><span class="p">.</span><span class="nx">EAGLE_EMPOWERMENT</span> <span class="o">+</span> <span class="mi">1</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="nx">t</span><span class="p">.</span><span class="nx">truthy</span><span class="p">(</span><span class="nx">subject</span><span class="p">(</span><span class="nx">eatCornStub</span><span class="p">).</span><span class="nx">hasCape</span><span class="p">)</span>
</span><span class='line'><span class="p">})</span>
</span><span class='line'>
</span><span class='line'><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;fewer nutrients remains cape-less&#39;</span><span class="p">,</span> <span class="nx">t</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">function</span> <span class="nx">eatCornStub</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">NUTRIENT_LEVELS</span><span class="p">.</span><span class="nx">EAGLE_EMPOWERMENT</span> <span class="o">-</span> <span class="mi">1</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="nx">t</span><span class="p">.</span><span class="nx">falsy</span><span class="p">(</span><span class="nx">subject</span><span class="p">(</span><span class="nx">eatCornStub</span><span class="p">).</span><span class="nx">hasCape</span><span class="p">)</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>By passing in our stub directly, we control the branching inside the function.</p>

<h2>Leaking Dependencies</h2>

<p>By exposing <code>eatCorn</code> as a function parameter, we&#8217;re telling all consumers that we rely on <code>eatCorn</code>.  We&#8217;ve leaked our dependency, lessening our encapsulation.  For the function to work as written, it always needs the consumer to send it the <code>eatCorn</code> argument when <code>prepForFight</code> is called.  Let&#8217;s give it a default, and make the consumer code care about our dependencies a bit less.  The default will be our original <code>require</code>d module.</p>

<figure class='code'><figcaption><span>prep-for-fight.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kr">const</span> <span class="nx">defaultEatCorn</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./eat-corn&#39;</span><span class="p">)</span>
</span><span class='line'><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">prepForFight</span><span class="p">(</span><span class="nx">eatCorn</span> <span class="o">=</span> <span class="nx">defaultEatCorn</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kr">const</span> <span class="nx">nutrients</span> <span class="o">=</span> <span class="nx">eatCorn</span><span class="p">()</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nx">nutrients</span> <span class="o">&gt;</span> <span class="nx">NUTRIENT_LEVELS</span><span class="p">.</span><span class="nx">EAGLE_EMPOWERMENT</span><span class="p">)</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">{</span> <span class="nx">hasCape</span><span class="o">:</span> <span class="nx">donHomemadeCape</span><span class="p">()</span> <span class="p">}</span>
</span><span class='line'>  <span class="c1">// ...</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now if <code>eatCorn</code> is <em>passed</em> as an argument, it will be used.  Otherwise, <code>defaultEatCorn</code>, which is the normal imported dependency, will be used.  This is great because now consumers don&#8217;t necessarily have to care about the dependency, except to override, which for now is just a thing our test wants to be able to do.</p>

<h2>Stub Without Changing Your Signature</h2>

<p>If putting <code>eatCorn</code> in your function parameter list bothers you, here&#8217;s another potential solution.</p>

<figure class='code'><figcaption><span>prep-for-fight.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kr">const</span> <span class="nx">eatCorn</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./eat-corn&#39;</span><span class="p">)</span>
</span><span class='line'><span class="nx">exports</span><span class="p">.</span><span class="nx">prepForFight</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">prepForFight</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="kr">const</span> <span class="nx">nutrients</span> <span class="o">=</span> <span class="nx">eatCorn</span><span class="p">()</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nx">nutrients</span> <span class="o">&gt;</span> <span class="nx">NUTRIENT_LEVELS</span><span class="p">.</span><span class="nx">EAGLE_EMPOWERMENT</span><span class="p">)</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">{</span> <span class="nx">hasCape</span><span class="o">:</span> <span class="nx">donHomemadeCape</span><span class="p">()</span> <span class="p">}</span>
</span><span class='line'>  <span class="c1">// ...</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">exports</span><span class="p">.</span><span class="nx">withEatCornForTest</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">withEatCornForTest</span><span class="p">(</span><span class="nx">eatCornOverride</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">eatCorn</span> <span class="o">=</span> <span class="nx">eatCornOverride</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now you can call <code>withEatCornForTest</code> before you exercise your subject under test:</p>

<figure class='code'><figcaption><span>prep-for-fight.spec.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kr">const</span> <span class="nx">test</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;ava&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="kr">const</span> <span class="nx">subject</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./prep-for-fight&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;many nutrients dons cape&#39;</span><span class="p">,</span> <span class="nx">t</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">function</span> <span class="nx">eatCornStub</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">NUTRIENT_LEVELS</span><span class="p">.</span><span class="nx">EAGLE_EMPOWERMENT</span> <span class="o">+</span> <span class="mi">1</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="nx">subject</span><span class="p">.</span><span class="nx">withEatCornForTest</span><span class="p">(</span><span class="nx">eatCornStub</span><span class="p">)</span>
</span><span class='line'>  <span class="nx">t</span><span class="p">.</span><span class="nx">truthy</span><span class="p">(</span><span class="nx">subject</span><span class="p">.</span><span class="nx">prepForFight</span><span class="p">().</span><span class="nx">hasCape</span><span class="p">)</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>This overrides the imported <code>eatCorn</code> module much like proxyquire does.  This is nice because your <code>prepForFight</code> function remains untouched, but I think there are a few drawbacks.</p>

<ul>
<li>We had to change our single export module to a multiple named export module in order to add the extra API for setting the dependency.</li>
<li>We have code in our src that is there specifically for testing.  The <code>*ForTest</code> suffix is a particularly clear flag of that.  But if we remove the <code>*ForTest</code> suffix, we simply cloud that fact and make something still test-specific look like it&#8217;s for general use.</li>
<li>We have made our <code>prepForFight</code> function impure, because now its output can change depending on when or if we call the <code>withEatCornForTest</code>, creating a module-global side effect.</li>
<li><code>withEatCornForTest</code> is further away from the <code>eatCorn</code> usage inside of <code>prepForFight</code>.  Thus, we could read <code>prepForFight</code> and never know that it&#8217;s possible for the <code>eatCorn</code> implementation to be switched out from under us without examination of more code outside that function.</li>
</ul>


<h2>Decouple Function Parameter Order</h2>

<p>Previous to reading Sandi Metz&#8217; <a href="http://www.poodr.com/">POODR</a> book, I hadn&#8217;t considered this, but she posits that a parameter list has coupling because of the order of the parameters.  To lessen the coupling, she proposes changing the function signature to take an argument hash instead.  This has the benefits of not requiring a specific order, letting consumers name the arguments, creating clarity on the consuming side, and having the consistency of a single argument for most/if not all functions that take input.</p>

<p>We can take advantage of these attributes and realize one of our own in our <code>prepForFight</code> function.  If we have multiple dependencies, we can put these dependencies and their defaults inside the argument hash, and no consumer has to know anything about it.  There&#8217;s no ordering problem.  There&#8217;s no null arugment passing.  We just specify the keys that we care to specify and have defaults for the rest.  A minor refactor might yield some destructuring of a single object sent to the function:</p>

<figure class='code'><figcaption><span>prep-for-fight.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kr">const</span> <span class="nx">defaultEatCorn</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./eat-corn&#39;</span><span class="p">)</span>
</span><span class='line'><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">prepForFight</span><span class="p">({</span> <span class="nx">eatCorn</span> <span class="o">=</span> <span class="nx">defaultEatCorn</span> <span class="cm">/*, more... */</span> <span class="p">})</span> <span class="p">{</span>
</span><span class='line'>  <span class="kr">const</span> <span class="nx">nutrients</span> <span class="o">=</span> <span class="nx">eatCorn</span><span class="p">()</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nx">nutrients</span> <span class="o">&gt;</span> <span class="nx">NUTRIENT_LEVELS</span><span class="p">.</span><span class="nx">EAGLE_EMPOWERMENT</span><span class="p">)</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">{</span> <span class="nx">hasCape</span><span class="o">:</span> <span class="nx">donHomemadeCape</span><span class="p">()</span> <span class="p">}</span>
</span><span class='line'>  <span class="c1">// ...</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>I think that&#8217;s probably our final refactor for now.  What could we do to make this better?  What are other stubbing methods that you&#8217;ve gotten a lot of mileage out of?</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Jake Trent</span></span>

      








  


<time datetime="2016-09-29T06:30:00-06:00" pubdate data-updated="true">Sep 29<span>th</span>, 2016</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/code/'>Code</a>, <a class='category' href='/blog/categories/js/'>js</a>, <a class='category' href='/blog/categories/nodejs/'>nodejs</a>, <a class='category' href='/blog/categories/unit-testing/'>unit-testing</a>
  
</span>


    </p>
    
      <div class="sharing">

  <ul class="rrssb-buttons">
    <li class="rrssb-twitter">
      <!-- Replace href with your Meta and URL information  -->
      <a href="http://twitter.com/home?status=Stub Dependencies in Node Without Proxyquire%20by%20@jaketrent%20%20http://jaketrent.com/post/stub-dependencies-node-without-proxyquire/" target="_blank">
        <span class="rrssb-icon">
            <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px"
                 width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
            <path d="M24.253,8.756C24.689,17.08,18.297,24.182,9.97,24.62c-3.122,0.162-6.219-0.646-8.861-2.32
                c2.703,0.179,5.376-0.648,7.508-2.321c-2.072-0.247-3.818-1.661-4.489-3.638c0.801,0.128,1.62,0.076,2.399-0.155
                C4.045,15.72,2.215,13.6,2.115,11.077c0.688,0.275,1.426,0.407,2.168,0.386c-2.135-1.65-2.729-4.621-1.394-6.965
                C5.575,7.816,9.54,9.84,13.803,10.071c-0.842-2.739,0.694-5.64,3.434-6.482c2.018-0.623,4.212,0.044,5.546,1.683
                c1.186-0.213,2.318-0.662,3.329-1.317c-0.385,1.256-1.247,2.312-2.399,2.942c1.048-0.106,2.069-0.394,3.019-0.851
                C26.275,7.229,25.39,8.196,24.253,8.756z"/>
            </svg>
        </span>
      </a>
    </li>
    <li class="rrssb-linkedin">
      <!-- Replace href with your meta and URL information -->
      <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=http://jaketrent.com/post/stub-dependencies-node-without-proxyquire/&amp;title=Stub Dependencies in Node Without Proxyquire&amp;summary=from jaketrent.com" target="_blank">
        <span class="rrssb-icon">
            <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                <path d="M25.424,15.887v8.447h-4.896v-7.882c0-1.979-0.709-3.331-2.48-3.331c-1.354,0-2.158,0.911-2.514,1.803
                    c-0.129,0.315-0.162,0.753-0.162,1.194v8.216h-4.899c0,0,0.066-13.349,0-14.731h4.899v2.088c-0.01,0.016-0.023,0.032-0.033,0.048
                    h0.033V11.69c0.65-1.002,1.812-2.435,4.414-2.435C23.008,9.254,25.424,11.361,25.424,15.887z M5.348,2.501
                    c-1.676,0-2.772,1.092-2.772,2.539c0,1.421,1.066,2.538,2.717,2.546h0.032c1.709,0,2.771-1.132,2.771-2.546
                    C8.054,3.593,7.019,2.501,5.343,2.501H5.348z M2.867,24.334h4.897V9.603H2.867V24.334z"/>
            </svg>
        </span>
      </a>
    </li>
    <li class="rrssb-googleplus">
      <!-- Replace href with your meta and URL information.  -->
      <a href="https://plus.google.com/share?url=http://jaketrent.com/post/stub-dependencies-node-without-proxyquire/" target="_blank">
        <span class="rrssb-icon">
            <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                <g>
                    <g>
                        <path d="M14.703,15.854l-1.219-0.948c-0.372-0.308-0.88-0.715-0.88-1.459c0-0.748,0.508-1.223,0.95-1.663
                            c1.42-1.119,2.839-2.309,2.839-4.817c0-2.58-1.621-3.937-2.399-4.581h2.097l2.202-1.383h-6.67c-1.83,0-4.467,0.433-6.398,2.027
                            C3.768,4.287,3.059,6.018,3.059,7.576c0,2.634,2.022,5.328,5.604,5.328c0.339,0,0.71-0.033,1.083-0.068
                            c-0.167,0.408-0.336,0.748-0.336,1.324c0,1.04,0.551,1.685,1.011,2.297c-1.524,0.104-4.37,0.273-6.467,1.562
                            c-1.998,1.188-2.605,2.916-2.605,4.137c0,2.512,2.358,4.84,7.289,4.84c5.822,0,8.904-3.223,8.904-6.41
                            c0.008-2.327-1.359-3.489-2.829-4.731H14.703z M10.269,11.951c-2.912,0-4.231-3.765-4.231-6.037c0-0.884,0.168-1.797,0.744-2.511
                            c0.543-0.679,1.489-1.12,2.372-1.12c2.807,0,4.256,3.798,4.256,6.242c0,0.612-0.067,1.694-0.845,2.478
                            c-0.537,0.55-1.438,0.948-2.295,0.951V11.951z M10.302,25.609c-3.621,0-5.957-1.732-5.957-4.142c0-2.408,2.165-3.223,2.911-3.492
                            c1.421-0.479,3.25-0.545,3.555-0.545c0.338,0,0.52,0,0.766,0.034c2.574,1.838,3.706,2.757,3.706,4.479
                            c-0.002,2.073-1.736,3.665-4.982,3.649L10.302,25.609z"/>
                        <polygon points="23.254,11.89 23.254,8.521 21.569,8.521 21.569,11.89 18.202,11.89 18.202,13.604 21.569,13.604 21.569,17.004
                            23.254,17.004 23.254,13.604 26.653,13.604 26.653,11.89      "/>
                    </g>
                </g>
            </svg>
        </span>
      </a>
    </li>
    <li class="rrssb-facebook">
      <!-- Replace with your URL. For best results, make sure you page has the proper FB Open Graph tags in header:
      https://developers.facebook.com/docs/opengraph/howtos/maximizing-distribution-media-content/ -->
      <a href="https://www.facebook.com/sharer/sharer.php?u=http://jaketrent.com/post/stub-dependencies-node-without-proxyquire/" target="_blank">
        <span class="rrssb-icon">
            <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                <path d="M27.825,4.783c0-2.427-2.182-4.608-4.608-4.608H4.783c-2.422,0-4.608,2.182-4.608,4.608v18.434
                    c0,2.427,2.181,4.608,4.608,4.608H14V17.379h-3.379v-4.608H14v-1.795c0-3.089,2.335-5.885,5.192-5.885h3.718v4.608h-3.726
                    c-0.408,0-0.884,0.492-0.884,1.236v1.836h4.609v4.608h-4.609v10.446h4.916c2.422,0,4.608-2.188,4.608-4.608V4.783z"/>
            </svg>
        </span>
      </a>
    </li>
  </ul>

</div>

    
    <p class="meta">
      
        <a class="prev-article-link" href="/post/notify-error-to-newrelic-on-uncaughtexception/" title="Previous Post: Notify NewRelic of Error on UncaughtException">&laquo; Notify NewRelic of Error on UncaughtException</a>
      
      
        <a class="next-article-link" href="/post/debug-log-in-elm-pipes/" title="Next Post: Debug.log in Elm Pipes">Debug.log in Elm Pipes &raquo;</a>
      
    </p>
  </footer>
</article>

  <section class="comments">
    <h2 class="comments-title">Comments</h2>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

    </div>
  </div>
  <div class="footer-container">
    <footer class="main-footer" role="contentinfo"><div class="main-footer-logo"></div>
<ul class="main-footer-links-list">
  <li class="main-footer-links-item">
    <span class="main-footer-verbage">Content licensed</span> 2017 <a href="http://creativecommons.org/licenses/by/3.0/us/">CC 3.0 Attribution</a>
  </li>
  <li class="main-footer-links-item">
    <span class="main-footer-verbage">Authored by </span><a href="https://plus.google.com/115032056022257436849?rel=author">Jake Trent</a>
  </li>
  <li class="main-footer-links-item">
    <span class="main-footer-verbage">Subscribe to the </span><a href="/atom.xml">Feed</a>
  </li>
  <li class="main-footer-links-item main-footer-links-item-extra">
    <a href="/sitemap.xml">Sitemap</a>
  </li>
  <li class="main-footer-links-item main-footer-links-item-extra">
    <a href="https://github.com/jaketrent/jaketrent-blog/issues/new">Report a Bug</a>
  </li>
  <li class="main-footer-links-item main-footer-links-item-extra">
    <span class="main-footer-verbage">Chat on </span><a href="https://keybase.io/jaketrent">Keybase</a>
  </li>
  <li class="main-footer-links-item main-footer-links-item-extra">
    <span class="main-footer-verbage">Powered by </span><a href="http://octopress.org">Octopress</a>
  </li>
</ul>

</footer>
  </div>
  

<script type="text/javascript">
      var disqus_shortname = 'jaketrent';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://jaketrent.com/post/stub-dependencies-node-without-proxyquire/';
        var disqus_url = 'http://jaketrent.com/post/stub-dependencies-node-without-proxyquire/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





</body>
</html>
