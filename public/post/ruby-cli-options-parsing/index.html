
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Ruby CLI Options Parsing - Jake Trent</title>

  <meta name="author" content="https://plus.google.com/115032056022257436849">
  
  <meta name="description" content="Making a CLI tool in Ruby is made more straightforward with an OptionParser in stdlib.">
  <meta name="keywords" content="ruby, OptionParser, OpenStruct, cli, command line, terminal, tool, options">
  <meta name="copyright" content="http://creativecommons.org/licenses/by/3.0/us/" />

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="Ruby CLI Options Parsing" />
  <meta property="og:type" content="article" />
  
  <meta property="og:url" content="http://jaketrent.com/post/ruby-cli-options-parsing/" />
  <meta property="og:description" content="Making a CLI tool in Ruby is made more straightforward with an OptionParser in stdlib." />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Ruby CLI Options Parsing" />
  <meta name="twitter:description" content="Making a CLI tool in Ruby is made more straightforward with an OptionParser in stdlib." />
  

  
  <link rel="canonical" href="http://jaketrent.com/post/ruby-cli-options-parsing/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Jake Trent" type="application/atom+xml">
  <meta name="google-site-verification" content="uvx7BhaUTNz29nQgydsFPRsErfqYBhPEV_svnHvW7H0" />

<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-16224416-4']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <div class="container">
    <div class="sidebar">
      <section class="logo">
  <header class="logo-header">
    <h2 class="logo-title">
      <a class="logo-link" href="/">
        <span class="logo-img"></span>
      </a>
    </h2>
  </header>
</section>

      <nav class="main-nav" role="navigation"><ul class="main-nav-list">
  <li class="main-nav-item">
    <a class="main-nav-link" href="/">Blog</a>
  </li>
  <li class="main-nav-item">
    <a class="main-nav-link" href="/work">Work</a>
  </li>
  <li class="main-nav-item">
    <a class="main-nav-link" href="https://books.jaketrent.com">Books</a>
  </li>
  <li class="main-nav-item">
    <a class="main-nav-link" href="https://github.com/jaketrent">Github</a>
  </li>
  <li class="main-nav-item">
    <a class="main-nav-link" href="http://www.linkedin.com/in/jaketrent">LinkedIn</a>
  </li>
</ul>
</nav>
    </div>
    <div class="content">
      <div>
<article class="entry entry-detail" role="article">
  
  <header>
    
      <h1 class="entry-title">Ruby CLI Options Parsing</h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-02-24T07:21:00-07:00" pubdate data-updated="true">Feb 24<span>th</span>, 2015</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>Ruby&#8217;s stdlib never ceases to amaze.  If you&#8217;re making a CLI tool in Ruby, your efforts are made more straightforward by the existence of the <a href="http://ruby-doc.org/stdlib-2.2.0/libdoc/optparse/rdoc/OptionParser.html">OptionParser</a> class.  Use it, and let happiness fill your heart.</p>

<p><img src="http://i.imgur.com/Z7WWtL0.jpg" alt="Ruby" /></p>

<!--more-->


<p>We&#8217;re used to some nice CLI tools these days &#8211; ones that have many useful options that allow for easier scripting and more powerful, quick usage.  Ruby&#8217;s <code>OptionParser</code> will help us make our own and not disappoint the masses of fevered CLI users.</p>

<p>All terminal input from initial execution will enter our Ruby program via the <code>ARGV</code> variable.</p>

<p>To have the <code>OptionParser</code> class available to us, we must require the <code>optsparse</code> package.</p>

<p><code>OptionParser</code> options are defined similar to how you&#8217;d expect event handlers to be defined: with the <code>on</code> keyword.  You can pass it a string to match a short option, a string to match the verbose option, and finally a block to be executed when the option is detected.  In the block, we generally will want to store the option state.  We&#8217;ll choose to use an <code>OpenStruct</code> for that (and will need the <code>ostruct</code> package).</p>

<p>For example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s2">&quot;optsparse&quot;</span>
</span><span class='line'><span class="nb">require</span> <span class="s2">&quot;ostruct&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="n">options</span> <span class="o">=</span> <span class="no">OpenStruct</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'><span class="n">opt_parser</span> <span class="o">=</span> <span class="no">OptionParser</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">opts</span><span class="o">|</span>
</span><span class='line'>    <span class="n">opts</span><span class="o">.</span><span class="n">banner</span> <span class="o">=</span> <span class="s2">&quot;Usage: luchador [options]&quot;</span>
</span><span class='line'>    <span class="n">opts</span><span class="o">.</span><span class="n">separator</span> <span class="s2">&quot;&quot;</span>
</span><span class='line'>    <span class="n">opts</span><span class="o">.</span><span class="n">separator</span> <span class="s2">&quot;Options:&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">opts</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="s2">&quot;-t, &quot;</span><span class="o">--</span><span class="n">twist</span><span class="s2">&quot;, &quot;</span><span class="no">Apply</span> <span class="n">the</span> <span class="n">nipple</span> <span class="n">twist</span><span class="s2">&quot;) do |t|</span>
</span><span class='line'><span class="s2">      options.twist = true</span>
</span><span class='line'><span class="s2">    end</span>
</span><span class='line'>
</span><span class='line'><span class="s2">    opts.on(&quot;</span><span class="o">-</span><span class="n">a</span> <span class="n">a</span><span class="s2">&quot;, &quot;</span><span class="o">--</span><span class="n">anaconda</span><span class="o">-</span><span class="n">squeeze</span> <span class="n">a</span><span class="s2">&quot;, &quot;</span><span class="no">The</span> <span class="n">degrees</span> <span class="n">of</span> <span class="n">anaconda</span> <span class="n">squeeze</span> <span class="n">pressure</span><span class="s2">&quot;) do |a|</span>
</span><span class='line'><span class="s2">      options.anaconda_squeeze = a</span>
</span><span class='line'><span class="s2">    end</span>
</span><span class='line'>
</span><span class='line'><span class="s2">    opt_parser.parse!(ARGV)</span>
</span><span class='line'><span class="s2">    options</span>
</span><span class='line'><span class="s2">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we can we might run CLI tool something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">luchador</span> <span class="o">-</span><span class="n">t</span> <span class="o">--</span><span class="n">anaconda</span><span class="o">-</span><span class="n">squeeze</span> <span class="mi">130</span>
</span></code></pre></td></tr></table></div></figure>


<p>And run with both options engaged for ultimate luchador power.  Notice we used both short and verbose-style options (choosing to write out the longest of the options for its added poetic punch on that whopping 130 degrees of pure squeeze pressure!).</p>

<p>A few more points to note:</p>

<ul>
<li><code>opts.banner</code> and <code>opts.separator</code> can be used to format usage information.</li>
<li>Usage information, stored in <code>opts</code> can be <code>put</code> to the screen.  A <code>-h</code>/<code>--help</code> option is automatically built in for this purpose.</li>
<li>Remember to call <code>parse!</code> after configuring the options so the input is actually processed.</li>
<li>Here, the <code>--anaconda-squeeze</code> option is defined differently than the first: there is a trailing <code>a</code>.  For options that require a non-boolean, this is required.  Otherwise, the argument to your handling block will always be a boolean <code>true</code>.</li>
<li>Note that this example code only shows option parsing &#8211; nothing about the <code>luchador</code> binary itself.</li>
</ul>


<p>This gives you the basic tools.  It&#8217;s very easy, and it&#8217;s built in!  To do more, you might take required options first through the CLI options and then read them interactively from the console.  What other neat additions do you see that we could add?</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Jake Trent</span></span>

      








  


<time datetime="2015-02-24T07:21:00-07:00" pubdate data-updated="true">Feb 24<span>th</span>, 2015</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/code/'>Code</a>, <a class='category' href='/blog/categories/ruby/'>ruby</a>
  
</span>


    </p>
    
      
    
    <p class="meta">
      
        <a class="prev-article-link" href="/post/test-react-router-params-component-update/" title="Previous Post: Test React-Router Previous Params for Component Update">&laquo; Test React-Router Previous Params for Component Update</a>
      
      
        <a class="next-article-link" href="/post/sinon-spies-vs-stubs/" title="Next Post: Sinon Spies vs. Stubs">Sinon Spies vs. Stubs &raquo;</a>
      
    </p>
  </footer>
</article>

  <section class="comments">
    <h2 class="comments-title">Comments</h2>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

    </div>
  </div>
  <div class="footer-container">
    <footer class="main-footer" role="contentinfo"><div class="main-footer-logo"></div>
<ul class="main-footer-links-list">
  <li class="main-footer-links-item">
    <span class="main-footer-verbage">Content licensed</span> 2017 <a href="http://creativecommons.org/licenses/by/3.0/us/">CC 3.0 Attribution</a>
  </li>
  <li class="main-footer-links-item">
    <span class="main-footer-verbage">Authored by </span><a href="https://plus.google.com/115032056022257436849?rel=author">Jake Trent</a>
  </li>
  <li class="main-footer-links-item">
    <span class="main-footer-verbage">Subscribe to the </span><a href="/atom.xml">Feed</a>
  </li>
  <li class="main-footer-links-item main-footer-links-item-extra">
    <a href="/sitemap.xml">Sitemap</a>
  </li>
  <li class="main-footer-links-item main-footer-links-item-extra">
    <a href="https://github.com/jaketrent/jaketrent-blog/issues/new">Report a Bug</a>
  </li>
  <li class="main-footer-links-item main-footer-links-item-extra">
    <span class="main-footer-verbage">Chat on </span><a href="https://keybase.io/jaketrent">Keybase</a>
  </li>
  <li class="main-footer-links-item main-footer-links-item-extra">
    <span class="main-footer-verbage">Powered by </span><a href="http://octopress.org">Octopress</a>
  </li>
</ul>

</footer>
  </div>
  

<script type="text/javascript">
      var disqus_shortname = 'jaketrent';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://jaketrent.com/post/ruby-cli-options-parsing/';
        var disqus_url = 'http://jaketrent.com/post/ruby-cli-options-parsing/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





</body>
</html>
