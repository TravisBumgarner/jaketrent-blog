
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>'And' Spring @Secured Roles - Jake Trent</title>

  <meta name="author" content="https://plus.google.com/115032056022257436849">
  
  <meta name="description" content="Spring Security (previously Acegi) gives you an awesome AOP way of locking down methods in your Java application. And well-placed <a href="http://www &hellip;">
  <meta name="keywords" content="security, spring, aop">
  <meta name="copyright" content="http://creativecommons.org/licenses/by/3.0/us/" />

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="'And' Spring @Secured Roles" />
  <meta property="og:type" content="article" />
  
  <meta property="og:url" content="http://jaketrent.com/post/and-spring-secured-roles/" />
  <meta property="og:description" content="Spring Security (previously Acegi) gives you an awesome AOP way of locking down methods in your Java application. And well-placed <a href="http://www &hellip;" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="'And' Spring @Secured Roles" />
  <meta name="twitter:description" content="Spring Security (previously Acegi) gives you an awesome AOP way of locking down methods in your Java application. And well-placed <a href="http://www &hellip;" />
  

  
  <link rel="canonical" href="http://jaketrent.com/post/and-spring-secured-roles/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Jake Trent" type="application/atom+xml">
  <meta name="google-site-verification" content="uvx7BhaUTNz29nQgydsFPRsErfqYBhPEV_svnHvW7H0" />

<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-16224416-4']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <div class="container">
    <div class="sidebar">
      <section class="logo">
  <header class="logo-header">
    <h2 class="logo-title">
      <a class="logo-link" href="/">
        <span class="logo-img"></span>
      </a>
    </h2>
  </header>
</section>

      <nav class="main-nav" role="navigation"><ul class="main-nav-list">
  <li class="main-nav-item">
    <a class="main-nav-link" href="/">Blog</a>
  </li>
  <li class="main-nav-item">
    <a class="main-nav-link" href="/work">Work</a>
  </li>
  <li class="main-nav-item">
    <a class="main-nav-link" href="https://books.jaketrent.com">Books</a>
  </li>
  <li class="main-nav-item">
    <a class="main-nav-link" href="https://github.com/jaketrent">Github</a>
  </li>
  <li class="main-nav-item">
    <a class="main-nav-link" href="http://www.linkedin.com/in/jaketrent">LinkedIn</a>
  </li>
</ul>
</nav>
    </div>
    <div class="content">
      <div>
<article class="entry entry-detail" role="article">
  
  <header>
    
      <h1 class="entry-title">'And' Spring @Secured Roles</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-06T10:30:00-07:00" pubdate data-updated="true">Jan 6<span>th</span>, 2012</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>Spring Security (previously Acegi) gives you an awesome AOP way of locking down methods in your Java application.  And well-placed <a href="http://www.youtube.com/watch?v=ldFOHUaf2zg">lock down</a> is a special power indeed.  However, Spring disappoints a bit on this score because it turns out its default behavior is to &#8216;or&#8217; the roles listed in @Secured annotation.  You&#8217;d think the default would be the stricter &#8216;and&#8217;, but alas.  But never fear, there is hope.</p>

<!--more-->


<p><em>Updated (21 June 2012)</em>:</p>

<h2>The easy way</h2>

<p>This article can be simplified into this line of code:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@PreAuthorize</span><span class="o">(</span><span class="s">&quot;hasRole(&#39;ROLE_role1&#39;) and hasRole(&#39;ROLE_role2&#39;)&quot;</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>There are other combo options <a href="http://static.springsource.org/spring-security/site/docs/3.0.x/reference/el-access.html">as documented by Spring</a>.</p>

<p>If you wish to go on, enjoy the custom code and xml config that follows:  :)</p>

<p>There is always hope.</p>

<p>Note:  My experimentation with this and the line numbers in files mentioned here are from spring-security-core/3.0.7.RELEASE.</p>

<h2>GrantedAuthority</h2>

<p>Your authorities populator or however you&#8217;re getting roles assigned to your user will eventually place them in the place that you can get to them programmatically:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">SecurityContextHolder</span><span class="o">.</span><span class="na">getContext</span><span class="o">().</span><span class="na">getAuthentication</span><span class="o">().</span><span class="na">getAuthorities</span><span class="o">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>And here is where the @Secured annotation will eventually look for them (AbstractSecurityInterceptor.java:204):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">Collection</span><span class="o">&lt;</span><span class="n">ConfigAttribute</span><span class="o">&gt;</span> <span class="n">attributes</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">obtainSecurityMetadataSource</span><span class="o">().</span><span class="na">getAttributes</span><span class="o">(</span><span class="n">object</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>This collection of <code>GrantedAuthorities</code> is are the roles that have been assigned to the user associated with your request to a method.</p>

<h2>@Secured</h2>

<p>When you want only users with certain authorities to access methods, you apply the <code>@Secured</code> annotation to the method needing protection.  Also note that you can specify multiple roles in this annotation:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Secured</span><span class="o">({</span><span class="s">&quot;role1&quot;</span><span class="o">,</span> <span class="s">&quot;role2&quot;</span><span class="o">})</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">makeSomethingAwesome</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>  <span class="c1">// pure awesome</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Again, to note what is important and initially stunned me:  By default, you just need one of these roles (either role1 OR role2) to make it into the innards of this awesomeness.  This is because of the default configuration.  From the <a href="http://static.springsource.org/spring-security/site/docs/3.0.x/reference/ns-config.html">Spring Security docs</a>:</p>

<p>The default strategy is to use an AffirmativeBased AccessDecisionManager with a RoleVoter and an AuthenticatedVoter.</p>

<h2>Role Name Prefix</h2>

<p>Another point worth making is about the prefix required for roles.  Roles that are counted by the <code>RoleVoter</code> are only seen as roles if they start with the specified prefix.  By default, <code>RoleVoter</code> sees this prefix as &#8220;ROLE_&#8221;.  It is settable, but be warned that your roles will count for nothing and your <code>@Secured</code> method will be totally exposed unless it looks something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Secured</span><span class="o">({</span><span class="s">&quot;ROLE_role1&quot;</span><span class="o">,</span> <span class="s">&quot;ROLE_role2&quot;</span><span class="o">})</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">makeSomethingAwesome</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>  <span class="c1">// pure awesome that is now protected</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>From the <code>RoleVoter</code> docs:</p>

<blockquote><p>Votes if any ConfigAttribute#getAttribute() starts with a prefix indicating that it is a role. The default prefix string is <code>ROLE_</code>, but this may be overridden to any value. It may also be set to empty, which means that essentially any attribute will be voted on. As described further below, the effect of an empty prefix may not be quite desirable.</p></blockquote>

<h2>The 2 Keys</h2>

<p>There are two key interfaces that Spring Security is using to determine how you want your roles checked that you specify in the <code>@Secured</code> annotation:</p>

<ul>
<li>AccessDecisionManager implemented as AffirmativeBased, ConsensusBased or UnanimousBased</li>
<li>AccessDecisionVoter, implemented as RoleVoter</li>
</ul>


<p>The decision manager is the class that has a collection of voters.  The decision manager orchestrates the voters and asks each in turn whether the requesting user should be let through the <code>@Secured</code> annotation or denied.  By default, the <code>AffirmativeBased</code> manager is used.</p>

<p>Each decision manager functions differently in how it counts the votes of its voters:</p>

<ul>
<li>AffirmativeBased - if any voter comes votes &#8216;yes&#8217; or &#8216;access granted&#8217;, the manager allows access</li>
<li>ConsensusBased - this manager is majority rules.  There can be votes &#8216;yes&#8217; and &#8216;no&#8217;, and as long as &#8216;yes&#8217; votes outnumber &#8216;no&#8217; votes, access is allowed</li>
<li>UnanimousBased - this manager requires every voter to vote &#8216;yes&#8217; or else access is denied</li>
</ul>


<p>Since this discussion is based around roles, we only care to use Spring&#8217;s <code>RoleVoter</code>.  Here&#8217;s part of its implementation, starting on line 98:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kt">int</span> <span class="nf">vote</span><span class="o">(</span><span class="n">Authentication</span> <span class="n">authentication</span><span class="o">,</span> <span class="n">Object</span> <span class="n">object</span><span class="o">,</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">ConfigAttribute</span><span class="o">&gt;</span> <span class="n">attributes</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">ACCESS_ABSTAIN</span><span class="o">;</span>
</span><span class='line'>  <span class="n">Collection</span><span class="o">&lt;</span><span class="n">GrantedAuthority</span><span class="o">&gt;</span> <span class="n">authorities</span> <span class="o">=</span> <span class="n">extractAuthorities</span><span class="o">(</span><span class="n">authentication</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">for</span> <span class="o">(</span><span class="n">ConfigAttribute</span> <span class="n">attribute</span> <span class="o">:</span> <span class="n">attributes</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">supports</span><span class="o">(</span><span class="n">attribute</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">result</span> <span class="o">=</span> <span class="n">ACCESS_DENIED</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Attempt to find a matching granted authority</span>
</span><span class='line'>      <span class="k">for</span> <span class="o">(</span><span class="n">GrantedAuthority</span> <span class="n">authority</span> <span class="o">:</span> <span class="n">authorities</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">attribute</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">authority</span><span class="o">.</span><span class="na">getAuthority</span><span class="o">()))</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">return</span> <span class="n">ACCESS_GRANTED</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Verbalized, this <code>vote()</code> method goes through each role specified in the <code>@Secured</code> annotation and for each of those checks whether the user has that role.  If he does, the voter returns its vote as &#8216;yes&#8217;.  Got that?  <em>At the first match, the vote is yes</em>.  This is a logical &#8216;or&#8217;.</p>

<h2>Making the role vote a logical &#8216;and&#8217;</h2>

<p>I don&#8217;t want my roles &#8216;or&#8217;ed together.  I want the uesr to be required to have them all in combination or I will deny him access.  Since we&#8217;ve already shown that the default <code>RoleVoter</code> uses a logical &#8216;or&#8217; operation, I guess we&#8217;ll need to write our own role voter that uses a logical &#8216;and&#8217;.  Potentially, that might be called &#8216;HasAllRolesVoter&#8217;, and  might look like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HasAllRolesVoter</span> <span class="kd">extends</span> <span class="n">RoleVoter</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">vote</span><span class="o">(</span><span class="n">Authentication</span> <span class="n">authentication</span><span class="o">,</span> <span class="n">Object</span> <span class="n">object</span><span class="o">,</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">ConfigAttribute</span><span class="o">&gt;</span> <span class="n">attributes</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">Collection</span><span class="o">&lt;</span><span class="n">GrantedAuthority</span><span class="o">&gt;</span> <span class="n">authorities</span> <span class="o">=</span> <span class="n">authentication</span><span class="o">.</span><span class="na">getAuthorities</span><span class="o">();</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">requiredMatches</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">matches</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
</span><span class='line'>    <span class="k">for</span> <span class="o">(</span><span class="n">ConfigAttribute</span> <span class="n">attribute</span> <span class="o">:</span> <span class="n">attributes</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">supports</span><span class="o">(</span><span class="n">attribute</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">for</span> <span class="o">(</span><span class="n">GrantedAuthority</span> <span class="n">authority</span> <span class="o">:</span> <span class="n">authorities</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">if</span> <span class="o">(</span><span class="n">attribute</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">authority</span><span class="o">.</span><span class="na">getAuthority</span><span class="o">()))</span> <span class="o">{</span>
</span><span class='line'>            <span class="o">++</span><span class="n">matches</span><span class="o">;</span>
</span><span class='line'>            <span class="k">break</span><span class="o">;</span>
</span><span class='line'>          <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">ACCESS_ABSTAIN</span><span class="o">;</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="n">requiredMatches</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">matches</span> <span class="o">&lt;</span> <span class="n">requiredMatches</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">result</span> <span class="o">=</span> <span class="n">ACCESS_DENIED</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">matches</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">matches</span> <span class="o">==</span> <span class="n">requiredMatches</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">result</span> <span class="o">=</span> <span class="n">ACCESS_GRANTED</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>It looks much like <code>RoleVoter</code>.  It extends <code>RoleVoter</code> and overrides <code>vote()</code>, which now goes through the roles on the <code>@Secured</code> annotation, checks each against the roles of the user, incrementing a count with each match.  If, in the end, there are as many matches as roles specified, we&#8217;ve found them all.  This is just a potential implementation.  There are probably many better was to get this done.</p>

<p>So now can we do a logical &#8216;and&#8217;?  Yes.  There are 3 ways of accomplishing this (and probably more):</p>

<ol>
<li>AffirmativeBased w/ HasAllRolesVoter</li>
<li>ConsensusBased w/ HasAllRolesVoter</li>
<li>UnanimousBased w/ RolesVoter</li>
</ol>


<p>Note that in the last option <code>UnanimousBased</code> access manager can use just the plain jane <code>RolesVoter</code>.  This is because <code>UnanimousBased</code> calls the <code>RoleVoter</code> up for vote for each individual role (one by one via the <code>singleAttributeList</code>) as opposed to the roles as a collection.  Thus, that combination ignores the fact that <code>RoleVoter</code> normally &#8216;or&#8217;s matching roles together.</p>

<h2>Configuration</h2>

<p>So, there really hasn&#8217;t been too much to this solution.  But as with most frameworks of this flexibility and complexity, the key is knowing how to actually specify that you want it to work this way.  To specify a <code>UnanimousBased</code> access manager using the plain <code>RoleVoter</code> (my eventual solution for my own problem) looks something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
</span><span class='line'>       <span class="na">xmlns:sec=</span><span class="s">&quot;http://www.springframework.org/schema/security&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
</span><span class='line'>         http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security-3.0.xsd&quot;&gt;
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;accessDecisionManager&quot;</span> <span class="na">class=</span><span class="s">&quot;org.springframework.security.access.vote.UnanimousBased&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;decisionVoters&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.springframework.security.access.vote.RoleVoter&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/property&gt;</span>
</span><span class='line'>    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;allowIfAllAbstainDecisions&quot;</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;messageSource&quot;</span> <span class="na">ref=</span><span class="s">&quot;messageSource&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/bean&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;sec:global-method-security</span> <span class="na">secured-annotations=</span><span class="s">&quot;enabled&quot;</span> <span class="na">jsr250-annotations=</span><span class="s">&quot;enabled&quot;</span> <span class="na">pre-post-annotations=</span><span class="s">&quot;enabled&quot;</span>
</span><span class='line'>    <span class="na">access-decision-manager-ref=</span><span class="s">&quot;accessDecisionManager&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;/beans&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Smooth as butter.  As with most Spring solutions, the answer was in an xml configuration.  Oh boy.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Jake Trent</span></span>

      








  


<time datetime="2012-01-06T10:30:00-07:00" pubdate data-updated="true">Jan 6<span>th</span>, 2012</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/code/'>Code</a>, <a class='category' href='/blog/categories/aop/'>aop</a>, <a class='category' href='/blog/categories/security/'>security</a>, <a class='category' href='/blog/categories/spring/'>spring</a>
  
</span>


    </p>
    
      
<div class="sharing">

  <ul class="rrssb-buttons">
    <li class="rrssb-twitter">
      <!-- Replace href with your Meta and URL information  -->
      <a href="http://twitter.com/home?status='And' Spring @Secured Roles%20by%20@jaketrent%20%20/post/and-spring-secured-roles/" class="popup">
        <span class="rrssb-icon">
            <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px"
                 width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
            <path d="M24.253,8.756C24.689,17.08,18.297,24.182,9.97,24.62c-3.122,0.162-6.219-0.646-8.861-2.32
                c2.703,0.179,5.376-0.648,7.508-2.321c-2.072-0.247-3.818-1.661-4.489-3.638c0.801,0.128,1.62,0.076,2.399-0.155
                C4.045,15.72,2.215,13.6,2.115,11.077c0.688,0.275,1.426,0.407,2.168,0.386c-2.135-1.65-2.729-4.621-1.394-6.965
                C5.575,7.816,9.54,9.84,13.803,10.071c-0.842-2.739,0.694-5.64,3.434-6.482c2.018-0.623,4.212,0.044,5.546,1.683
                c1.186-0.213,2.318-0.662,3.329-1.317c-0.385,1.256-1.247,2.312-2.399,2.942c1.048-0.106,2.069-0.394,3.019-0.851
                C26.275,7.229,25.39,8.196,24.253,8.756z"/>
            </svg>
        </span>
      </a>
    </li>
    <li class="rrssb-linkedin">
      <!-- Replace href with your meta and URL information -->
      <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=/post/and-spring-secured-roles/&amp;title='And' Spring @Secured Roles&amp;summary=from jaketrent.com" class="popup">
        <span class="rrssb-icon">
            <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                <path d="M25.424,15.887v8.447h-4.896v-7.882c0-1.979-0.709-3.331-2.48-3.331c-1.354,0-2.158,0.911-2.514,1.803
                    c-0.129,0.315-0.162,0.753-0.162,1.194v8.216h-4.899c0,0,0.066-13.349,0-14.731h4.899v2.088c-0.01,0.016-0.023,0.032-0.033,0.048
                    h0.033V11.69c0.65-1.002,1.812-2.435,4.414-2.435C23.008,9.254,25.424,11.361,25.424,15.887z M5.348,2.501
                    c-1.676,0-2.772,1.092-2.772,2.539c0,1.421,1.066,2.538,2.717,2.546h0.032c1.709,0,2.771-1.132,2.771-2.546
                    C8.054,3.593,7.019,2.501,5.343,2.501H5.348z M2.867,24.334h4.897V9.603H2.867V24.334z"/>
            </svg>
        </span>
      </a>
    </li>
    <li class="rrssb-googleplus">
      <!-- Replace href with your meta and URL information.  -->
      <a href="https://plus.google.com/share?url=/post/and-spring-secured-roles/" class="popup">
        <span class="rrssb-icon">
            <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                <g>
                    <g>
                        <path d="M14.703,15.854l-1.219-0.948c-0.372-0.308-0.88-0.715-0.88-1.459c0-0.748,0.508-1.223,0.95-1.663
                            c1.42-1.119,2.839-2.309,2.839-4.817c0-2.58-1.621-3.937-2.399-4.581h2.097l2.202-1.383h-6.67c-1.83,0-4.467,0.433-6.398,2.027
                            C3.768,4.287,3.059,6.018,3.059,7.576c0,2.634,2.022,5.328,5.604,5.328c0.339,0,0.71-0.033,1.083-0.068
                            c-0.167,0.408-0.336,0.748-0.336,1.324c0,1.04,0.551,1.685,1.011,2.297c-1.524,0.104-4.37,0.273-6.467,1.562
                            c-1.998,1.188-2.605,2.916-2.605,4.137c0,2.512,2.358,4.84,7.289,4.84c5.822,0,8.904-3.223,8.904-6.41
                            c0.008-2.327-1.359-3.489-2.829-4.731H14.703z M10.269,11.951c-2.912,0-4.231-3.765-4.231-6.037c0-0.884,0.168-1.797,0.744-2.511
                            c0.543-0.679,1.489-1.12,2.372-1.12c2.807,0,4.256,3.798,4.256,6.242c0,0.612-0.067,1.694-0.845,2.478
                            c-0.537,0.55-1.438,0.948-2.295,0.951V11.951z M10.302,25.609c-3.621,0-5.957-1.732-5.957-4.142c0-2.408,2.165-3.223,2.911-3.492
                            c1.421-0.479,3.25-0.545,3.555-0.545c0.338,0,0.52,0,0.766,0.034c2.574,1.838,3.706,2.757,3.706,4.479
                            c-0.002,2.073-1.736,3.665-4.982,3.649L10.302,25.609z"/>
                        <polygon points="23.254,11.89 23.254,8.521 21.569,8.521 21.569,11.89 18.202,11.89 18.202,13.604 21.569,13.604 21.569,17.004
                            23.254,17.004 23.254,13.604 26.653,13.604 26.653,11.89      "/>
                    </g>
                </g>
            </svg>
        </span>
      </a>
    </li>
    <li class="rrssb-facebook">
      <!-- Replace with your URL. For best results, make sure you page has the proper FB Open Graph tags in header:
      https://developers.facebook.com/docs/opengraph/howtos/maximizing-distribution-media-content/ -->
      <a href="https://www.facebook.com/sharer/sharer.php?u=/post/and-spring-secured-roles/" class="popup">
        <span class="rrssb-icon">
            <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                <path d="M27.825,4.783c0-2.427-2.182-4.608-4.608-4.608H4.783c-2.422,0-4.608,2.182-4.608,4.608v18.434
                    c0,2.427,2.181,4.608,4.608,4.608H14V17.379h-3.379v-4.608H14v-1.795c0-3.089,2.335-5.885,5.192-5.885h3.718v4.608h-3.726
                    c-0.408,0-0.884,0.492-0.884,1.236v1.836h4.609v4.608h-4.609v10.446h4.916c2.422,0,4.608-2.188,4.608-4.608V4.783z"/>
            </svg>
        </span>
      </a>
    </li>
  </ul>

</div>

    
    <p class="meta">
      
        <a class="prev-article-link" href="/post/calling-webservices-java/" title="Previous Post: Calling Webservices in Java">&laquo; Calling Webservices in Java</a>
      
      
        <a class="next-article-link" href="/post/custom-exception-handling-accessdeniedexception/" title="Next Post: Custom Exception Handling for AccessDeniedException">Custom Exception Handling for AccessDeniedException &raquo;</a>
      
    </p>
  </footer>
</article>

  <section class="comments">
    <h2 class="comments-title">Comments</h2>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

    </div>
  </div>
  <div class="footer-container">
    <footer class="main-footer" role="contentinfo"><div class="main-footer-logo"></div>
<ul class="main-footer-links-list">
  <li class="main-footer-links-item">
    <span class="main-footer-verbage">Content licensed</span> 2014 <a href="http://creativecommons.org/licenses/by/3.0/us/">CC 3.0 Attribution</a>
  </li>
  <li class="main-footer-links-item">
    <span class="main-footer-verbage">Authored by </span><a href="https://plus.google.com/115032056022257436849?rel=author">Jake Trent</a>
  </li>
  <li class="main-footer-links-item">
    <span class="main-footer-verbage">Subscribe to the </span><a href="/atom.xml">Feed</a>
  </li>
  <li class="main-footer-links-item main-footer-links-item-extra">
    <a href="/sitemap.xml">Sitemap</a>
  </li>
  <li class="main-footer-links-item main-footer-links-item-extra">
    <a href="https://github.com/jaketrent/jaketrent-blog/issues">Report a Bug</a>
  </li>
  <li class="main-footer-links-item main-footer-links-item-extra">
    <span class="main-footer-verbage">Chat on </span><a href="https://keybase.io/jaketrent">Keybase</a>
  </li>
  <li class="main-footer-links-item main-footer-links-item-extra">
    <span class="main-footer-verbage">Powered by </span><a href="http://octopress.org">Octopress</a>
  </li>
</ul>
</footer>
  </div>
  

<script type="text/javascript">
      var disqus_shortname = 'jaketrent';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://jaketrent.com/post/and-spring-secured-roles/';
        var disqus_url = 'http://jaketrent.com/post/and-spring-secured-roles/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





</body>
</html>
