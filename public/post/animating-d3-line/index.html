
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Animating a Line in D3 - Jake Trent</title>

  <meta name="author" content="https://plus.google.com/115032056022257436849">
  
  <meta name="description" content="D3 makes awesome charts, made awesomer by animations. Make your lines animate!">
  <meta name="keywords" content="js, d3, line, animating, drawing, line chart">
  <meta name="copyright" content="http://creativecommons.org/licenses/by/3.0/us/" />

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="Animating a Line in D3" />
  <meta property="og:type" content="article" />
  <meta property="og:image" content="http://i.imgur.com/94JQ8N8.jpg" />
  <meta property="og:url" content="http://jaketrent.com/post/animating-d3-line/" />
  <meta property="og:description" content="D3 makes awesome charts, made awesomer by animations. Make your lines animate!" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Animating a Line in D3" />
  <meta name="twitter:description" content="D3 makes awesome charts, made awesomer by animations. Make your lines animate!" />
  <meta name="twitter:image" content="http://i.imgur.com/94JQ8N8.jpg" />

  
  <link rel="canonical" href="http://jaketrent.com/post/animating-d3-line/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Jake Trent" type="application/atom+xml">
  <meta name="google-site-verification" content="uvx7BhaUTNz29nQgydsFPRsErfqYBhPEV_svnHvW7H0" />

<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-16224416-4']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <div class="container">
    <div class="sidebar">
      <section class="logo">
  <header class="logo-header">
    <h2 class="logo-title">
      <a class="logo-link" href="/">
        <span class="logo-img"></span>
      </a>
    </h2>
  </header>
</section>

      <nav class="main-nav" role="navigation"><ul class="main-nav-list">
  <li class="main-nav-item">
    <a class="main-nav-link" href="/">Blog</a>
  </li>
  <li class="main-nav-item">
    <a class="main-nav-link" href="/work">Work</a>
  </li>
  <li class="main-nav-item">
    <a class="main-nav-link" href="https://books.jaketrent.com">Books</a>
  </li>
  <li class="main-nav-item">
    <a class="main-nav-link" href="https://github.com/jaketrent">Github</a>
  </li>
  <li class="main-nav-item">
    <a class="main-nav-link" href="http://www.linkedin.com/in/jaketrent">LinkedIn</a>
  </li>
</ul>
</nav>
    </div>
    <div class="content">
      <div>
<article class="entry entry-detail" role="article">
  
  <header>
    
      <h1 class="entry-title">Animating a Line in D3</h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-07-27T07:01:00-06:00" pubdate data-updated="true">Jul 27<span>th</span>, 2015</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>You can make some awesome charts in D3.  Animate your charts, and they&#8217;re made even awesomerer.  To animate lines, such as those found in line charts, try out the following methods.</p>

<p><img src="http://i.imgur.com/94JQ8N8.jpg" alt="d3 line animation" /></p>

<!--more-->


<h2>D3 Transition</h2>

<p>In order to animate in D3, you call the <code>transition</code> function on a <code>d3.selection</code>.  The transition essentially creates a tween from the starting point of the animation to the specified ending point.  So, to specify an animation:</p>

<ol>
<li>Set the starting state</li>
<li>Specify that you are transitioning</li>
<li>Set the ending state</li>
</ol>


<p>Then D3 will handle the animation on the diff between the starting and ending state.</p>

<h2>SVG Line Animation</h2>

<p>An SVG line element has 4 required attributes, <code>x1</code>, <code>y1</code>, <code>x2</code>, and <code>y2</code>.  These required attributes specify where the line begins and ends in a 2D space.  When choosing your coordinates, remember that the SVG coordinate plane starts at (0,0) in the top-left of the SVG element.</p>

<p>For our line animation, we want the line to look like it&#8217;s being drawing from the beginning to the ending point.  We will follow the general formula for defining a D3 transition as stated above.  Assuming we have an <code>svg</code> element from the DOM selected, the remaining code might look like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">svg</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;line&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
</span><span class='line'>    <span class="nx">x1</span><span class="o">:</span> <span class="mi">25</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">y1</span><span class="o">:</span> <span class="mi">15</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">x2</span><span class="o">:</span> <span class="mi">25</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">y2</span><span class="o">:</span> <span class="mi">15</span>
</span><span class='line'>  <span class="p">})</span>
</span><span class='line'>  <span class="p">.</span><span class="nx">transition</span><span class="p">()</span>
</span><span class='line'>  <span class="p">.</span><span class="nx">duration</span><span class="p">(</span><span class="mi">1500</span><span class="p">)</span>
</span><span class='line'>  <span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
</span><span class='line'>    <span class="nx">x2</span><span class="o">:</span> <span class="mi">400</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">y2</span><span class="o">:</span> <span class="mi">15</span>
</span><span class='line'>  <span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>In the code above, the line&#8217;s starting state shows the line beginning and end at the same point, (25, 15).  This is so that the line appears to be <code>15px</code> long when first seen in the UI.  Then, over time it will grow.  Note that the <code>attr</code>s set after the <code>transition</code> call specify the end of the line as being <code>400px</code> to the right.  Thus, over the duration of the transition (set to 1500ms in order to observe it), the line will appear to grow to its final length of 400px in the horizontal direction.</p>

<p data-height="266" data-theme-id="1749" data-slug-hash="Pqyvqo" data-default-tab="result" data-user="jaketrent" class='codepen'>See the Pen <a href='http://codepen.io/jaketrent/pen/Pqyvqo/'>Pqyvqo</a> by Jake Trent (<a href='http://codepen.io/jaketrent'>@jaketrent</a>) on <a href='http://codepen.io'>CodePen</a>.</p>


<script async src="//assets.codepen.io/assets/embed/ei.js"></script>


<h2>D3 Line Function</h2>

<p>D3 line functions are specified differently than SVG lines.  An SVG line is guaranteed to be a straight edge from the beginning to the ending point.  On the other hand, a D3 line function can describe a line through many different points, and can thus be anything but straight.  Think of a zig-zaggy line chart, and this is what a D3 line function is meant to accomplish.  Thus, a D3 line function is often used to generate the data needed for an SVG <code>path</code>, not a <code>line</code> element.  There will still be an SVG <code>stroke</code> on a path, but we will use a different technique to animate it.</p>

<h4>Strokes with Dashes</h4>

<p>There are two attributes to of a <code>stroke</code> in SVG that we will use:</p>

<ul>
<li><code>stroke-dasharray</code> - a set of 2 numbers.  The first number is the length of the dash.  The second number is the length between the dashes.</li>
<li><code>stroke-dashoffset</code> - a dash pattern is repeated, according to the <code>stroke-dasharray</code> attribute.  But this attribute specifies where to start in that repeating pattern.  In other words, how many pixels offset <em>into</em> that pattern should the first iteration of the pattern begin.  The default is 0px.</li>
</ul>


<p>To see these numbers change and how they affect a line, check out the following SVG lines:</p>

<p data-height="266" data-theme-id="1749" data-slug-hash="GJYaqK" data-default-tab="result" data-user="jaketrent" class='codepen'>See the Pen <a href='http://codepen.io/jaketrent/pen/GJYaqK/'>SVG Stroke Dasharray Grows a Line</a> by Jake Trent (<a href='http://codepen.io/jaketrent'>@jaketrent</a>) on <a href='http://codepen.io'>CodePen</a>.</p>


<script async src="//assets.codepen.io/assets/embed/ei.js"></script>


<p>In each of the above cases, the <code>stroke-dasharray</code> is set so the dash line length and the dash space length are equal to the total length of the total line.  Note that the <code>stroke-dashoffset</code> is the only attribute that changes between the 3 lines.</p>

<ol>
<li>In the first, the <code>stroke-dashoffset</code> is set to the length of the total line.  This means that the <code>stroke-dasharray</code> pattern begins at the point where the space between the dashes begins.  Thus, the line appears invisible &#8211; it&#8217;s just the line-length space between the dashes.</li>
<li>In the second, the <code>stroke-dashoffset</code> is set to the mid-length of the total line.  Thus, the 2nd half of the first dash is visible, making the line seem half as long as its total intended length.</li>
<li>Finally, the <code>stroke-dashoffset</code> is set to 0, meaning that the total line-length dash is now fully visible.</li>
</ol>


<h4>Animating with <code>stroke-dasharray</code></h4>

<p>One could imagine that were the <code>stroke-dashoffset</code> to tween from the full line length to 0, the line would appear to grow from the left to the right.  At first, the space between the dash would be fully visible, slowly, backing off the <code>stroke-dashoffset</code> until the pattern, which begins with a dash be fully visible.  Let&#8217;s try it:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">[</span>
</span><span class='line'>  <span class="p">{</span> <span class="nx">x</span><span class="o">:</span> <span class="mi">15</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="mi">15</span> <span class="p">},</span>
</span><span class='line'>  <span class="p">{</span> <span class="nx">x</span><span class="o">:</span> <span class="mi">400</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="mi">15</span> <span class="p">}</span>
</span><span class='line'><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">line</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">svg</span><span class="p">.</span><span class="nx">line</span><span class="p">()</span>
</span><span class='line'>  <span class="p">.</span><span class="nx">x</span><span class="p">(</span><span class="nx">d</span> <span class="o">=&gt;</span> <span class="nx">d</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span>
</span><span class='line'>  <span class="p">.</span><span class="nx">y</span><span class="p">(</span><span class="nx">d</span> <span class="o">=&gt;</span> <span class="nx">d</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">svg</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="p">.</span><span class="nx">datum</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
</span><span class='line'>    <span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
</span><span class='line'>      <span class="s1">&#39;d&#39;</span><span class="o">:</span> <span class="nx">line</span><span class="p">,</span>
</span><span class='line'>      <span class="s1">&#39;stroke-dasharray&#39;</span><span class="o">:</span> <span class="s1">&#39;385 385&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="s1">&#39;stroke-dashoffset&#39;</span><span class="o">:</span> <span class="mi">385</span>
</span><span class='line'>    <span class="p">})</span>
</span><span class='line'>  <span class="p">.</span><span class="nx">transition</span><span class="p">()</span>
</span><span class='line'>    <span class="p">.</span><span class="nx">duration</span><span class="p">(</span><span class="mi">1500</span><span class="p">)</span>
</span><span class='line'>    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;stroke-dashoffset&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>




<p data-height="266" data-theme-id="1749" data-slug-hash="JdmqRm" data-default-tab="result" data-user="jaketrent" class='codepen'>See the Pen <a href='http://codepen.io/jaketrent/pen/JdmqRm/'>JdmqRm</a> by Jake Trent (<a href='http://codepen.io/jaketrent'>@jaketrent</a>) on <a href='http://codepen.io'>CodePen</a>.</p>


<script async src="//assets.codepen.io/assets/embed/ei.js"></script>


<p>The above is the simplest possible example of how to make this happen.  In real life, you&#8217;re going to have:</p>

<ul>
<li>No foreknowledge of the data domain or maybe even the visual space range and will need a d3 scale (eg, <code>d3.scale.linear</code>)</li>
<li>A more complicated set of data which is going to lead to a more complicated line and the actual need for the line function used above</li>
<li>A more complicated line where the length is not immediately obvious and where <code>path.node().getTotalLength()</code> will be useful as a way to use the browser&#8217;s distance-along-a-path algorithm</li>
</ul>


<p>In the example above, note that the total length of the line is <code>385px</code>.  We make the line dashed.  We set the dash length and the space between the dash length to both be <code>385px</code> using <code>stroke-dasharray</code>.  We define the animation by making the starting state have a <code>stroke-dashoffset</code> of <code>385px</code>, showing nothing but the invisible space between the dash to start.  Then we tween to a <code>stroke-dashoffset</code> of <code>0</code>, causing the offset window to shrink until we see the dash, which is the length of the total line, grow into view.</p>

<p>Frankly, this dash-based solution feels like a hack.  It doesn&#8217;t seem like someone sat back and thought much about how to animate a non-linear path.  But this solution works well all the times I&#8217;ve used it.</p>

<p>What are some other solutions that you&#8217;ve found for animating lines or creating other interesting line animations?</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Jake Trent</span></span>

      








  


<time datetime="2015-07-27T07:01:00-06:00" pubdate data-updated="true">Jul 27<span>th</span>, 2015</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/code/'>Code</a>, <a class='category' href='/blog/categories/d3/'>d3</a>, <a class='category' href='/blog/categories/js/'>js</a>
  
</span>


    </p>
    
      
    
    <p class="meta">
      
        <a class="prev-article-link" href="/post/slack-survival-guide/" title="Previous Post: Slack Survival Guide">&laquo; Slack Survival Guide</a>
      
      
        <a class="next-article-link" href="/post/vision-questing/" title="Next Post: A Vision Questing We Will Go">A Vision Questing We Will Go &raquo;</a>
      
    </p>
  </footer>
</article>

  <section class="comments">
    <h2 class="comments-title">Comments</h2>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

    </div>
  </div>
  <div class="footer-container">
    <footer class="main-footer" role="contentinfo"><div class="main-footer-logo"></div>
<ul class="main-footer-links-list">
  <li class="main-footer-links-item">
    <span class="main-footer-verbage">Content licensed</span> 2017 <a href="http://creativecommons.org/licenses/by/3.0/us/">CC 3.0 Attribution</a>
  </li>
  <li class="main-footer-links-item">
    <span class="main-footer-verbage">Authored by </span><a href="https://plus.google.com/115032056022257436849?rel=author">Jake Trent</a>
  </li>
  <li class="main-footer-links-item">
    <span class="main-footer-verbage">Subscribe to the </span><a href="/atom.xml">Feed</a>
  </li>
  <li class="main-footer-links-item main-footer-links-item-extra">
    <a href="/sitemap.xml">Sitemap</a>
  </li>
  <li class="main-footer-links-item main-footer-links-item-extra">
    <a href="https://github.com/jaketrent/jaketrent-blog/issues/new">Report a Bug</a>
  </li>
  <li class="main-footer-links-item main-footer-links-item-extra">
    <span class="main-footer-verbage">Chat on </span><a href="https://keybase.io/jaketrent">Keybase</a>
  </li>
  <li class="main-footer-links-item main-footer-links-item-extra">
    <span class="main-footer-verbage">Powered by </span><a href="http://octopress.org">Octopress</a>
  </li>
</ul>

</footer>
  </div>
  

<script type="text/javascript">
      var disqus_shortname = 'jaketrent';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://jaketrent.com/post/animating-d3-line/';
        var disqus_url = 'http://jaketrent.com/post/animating-d3-line/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





</body>
</html>
