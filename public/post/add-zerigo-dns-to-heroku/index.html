
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Add Zerigo DNS to Heroku - Jake Trent</title>

  <meta name="author" content="https://plus.google.com/115032056022257436849">
  
  <meta name="description" content="Heroku has a great addon to setup DNS routing for you called Zerigo. Here's help where the docs fail.">
  <meta name="keywords" content="heroku, zerigo, dns, nameserver, bamboo, h70">
  <meta name="copyright" content="http://creativecommons.org/licenses/by/3.0/us/" />

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="Add Zerigo DNS to Heroku" />
  <meta property="og:type" content="article" />
  
  <meta property="og:url" content="http://jaketrent.com/post/add-zerigo-dns-to-heroku/" />
  <meta property="og:description" content="Heroku has a great addon to setup DNS routing for you called Zerigo. Here's help where the docs fail." />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Add Zerigo DNS to Heroku" />
  <meta name="twitter:description" content="Heroku has a great addon to setup DNS routing for you called Zerigo. Here's help where the docs fail." />
  

  
  <link rel="canonical" href="http://jaketrent.com/post/add-zerigo-dns-to-heroku/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Jake Trent" type="application/atom+xml">
  <meta name="google-site-verification" content="uvx7BhaUTNz29nQgydsFPRsErfqYBhPEV_svnHvW7H0" />

<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-16224416-4']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <div class="container">
    <div class="sidebar">
      <nav class="main-nav" role="navigation"><ul class="main-nav-list">
  <li class="main-nav-item">
    <a class="main-nav-link" href="/">Blog</a>
  </li>
  <li class="main-nav-item">
    <a class="main-nav-link" href="/work">Work</a>
  </li>
  <li class="main-nav-item">
    <a class="main-nav-link" href="/books">Books</a>
  </li>
  <li class="main-nav-item">
    <a class="main-nav-link" href="https://github.com/jaketrent">Github</a>
  </li>
  <li class="main-nav-item">
    <a class="main-nav-link" href="http://www.linkedin.com/in/jaketrent">LinkedIn</a>
  </li>
</ul>
</nav>
      <article class="logo">
  <header class="logo-header">
    <h2 class="logo-title">
      <a class="logo-link" href="/">JakeTrent.com</a>
    </h2>
  </header>
</article>

    </div>
    <div class="content">
      <div>
<article class="entry entry-detail" role="article">
  
  <header>
    
      <h1 class="entry-title">Add Zerigo DNS to Heroku</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-12-31T07:03:00-07:00" pubdate data-updated="true">Dec 31<span>st</span>, 2013</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>Once upon a time, I could setup DNS super easily on Heroku using their Zerigo DNS addon.  Lately, I tried again using the same pattern and failed.  Here&#8217;s an updated step-by-step guide.</p>

<p><img src="http://i.imgur.com/6DUwRKt.png" alt="Heroku and Zerigo" /></p>

<!--more-->


<h2>Back in the Day</h2>

<p>It used to be that all you had to do was setup the nameservers on your domain registrar, add the Zerigo addon on Heroku&#8217;s end with a few commands, and you were rocking in minutes.  The latest DNS setup on Heroku caused me a bit more grief.  Something has changed.  But there is hope.  The new steps are almost just as brief.  You&#8217;ll just have to take care to get it just right.</p>

<h2>Cedar, not Bamboo</h2>

<p>These days new deployments on Heroku are going to favor using the Cedar stack as the new option.  The Bamboo stack was the original and older Ruby stack.  And so it troubled me after setting up my DNS as I used to that I got an error message (<a href="https://devcenter.heroku.com/articles/error-codes#h70-access-to-bamboo-http-endpoint-denied">h70</a>) similar to this in my logs:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>2010-10-06T21:51:07-07:00 heroku<span class="o">[</span>router<span class="o">]</span>: <span class="nv">at</span><span class="o">=</span>error <span class="nv">code</span><span class="o">=</span>H70 <span class="nv">desc</span><span class="o">=</span><span class="s2">&quot;Access to bamboo HTTP endpoint denied&quot;</span> <span class="nv">method</span><span class="o">=</span>GET <span class="nv">path</span><span class="o">=</span>/ <span class="nv">host</span><span class="o">=</span>foo.myapp.com <span class="nv">fwd</span><span class="o">=</span>17.17.17.17 <span class="nv">dyno</span><span class="o">=</span> <span class="nv">connect</span><span class="o">=</span> <span class="nv">service</span><span class="o">=</span> <span class="nv">status</span><span class="o">=</span>503 <span class="nv">bytes</span><span class="o">=</span>
</span></code></pre></td></tr></table></div></figure>


<p>Lame, lame, lame, lame, lame.  Now, who did you contact?</p>

<p>Running <code>heroku info</code> reveals that I&#8217;m indeed using the Cedar stack on this project, so what gives?  It turns out my DNS was messed up.</p>

<h2>The New Zerigo/Heroku Setup</h2>

<p>The <a href="https://devcenter.heroku.com/articles/zerigo_dns">Heroku devcenter docs for Zerigo</a> are pretty good, but as of this writing, they&#8217;re a little inaccurate.  Here is the step-by-step that worked for me:</p>

<h4>1. Nameservers</h4>

<p>Setup your domain via your registrar&#8217;s site to point to these nameservers:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>a.ns.zerigo.net
</span><span class='line'>b.ns.zerigo.net
</span><span class='line'>c.ns.zerigo.net
</span><span class='line'>d.ns.zerigo.net
</span><span class='line'>e.ns.zerigo.net
</span></code></pre></td></tr></table></div></figure>


<h4>2. Zerigo Addon</h4>

<p>Add the Zerigo addon via the Heroku cli:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>heroku addons:add zerigo_dns
</span></code></pre></td></tr></table></div></figure>


<h4>3. Zerigo Config</h4>

<p>Open Zerigo addon for configuration:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>heroku addons:open zerigo_dns
</span></code></pre></td></tr></table></div></figure>


<p>Navigate to the Zerigo site for your app and press the &#8220;Add Snippet&#8221; button.  From the snippets available, select &#8220;Heroku&#8221;.  This snippet contains a CNAME entry and a URL redirect entry.  Add the snippet.  Now, you&#8217;ll need to adjust the CNAME entry.  The <code>data</code> field probably reads <code>proxy.heroku.com</code>.  This has been deprecated.  Instead, change the CNAME entry to point to <code>yourapp.herokuapp.com</code>.</p>

<p>Note also that the URL redirect entry is moving all traffic from yourapp.com to http://www.yourapp.com.  Apparently now the &#8220;www.&#8221; subdomain is required and you can&#8217;t setup a naked domain on Heroku.  If someone knows otherwise, I&#8217;d love to here about it, because I used to do this all the time.</p>

<h4>4. Add Domains on Heroku</h4>

<p>Via the Heroku cli, type:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>heroku domains:add www.yourapp.com
</span></code></pre></td></tr></table></div></figure>


<p>Note that we do <em>not</em> want to add <code>yourapp.com</code> (no &#8220;www&#8221;) to in this manner.  If you do that, the tool adds multiple A records to Zerigo, which the Zerigo docs clearly state you don&#8217;t want.  These A records are what will activate routing through the Bamboo stack, which you want to avoid.</p>

<p>This should be the point at which you can refresh your browser at &#8220;yourapp.com&#8221;.  You should see the redirect happen, moving you to &#8220;www.yourapp.com&#8221;.  The routing should be happy on Heroku&#8217;s end.  It sometimes takes more time for this to propagate, so if you don&#8217;t see results immediately, be a bit patient before your start changing your configuration, thinking it&#8217;s not working.</p>

<p>Has anyone else run into this?  Is there a better way to set this up?</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Jake Trent</span></span>

      








  


<time datetime="2013-12-31T07:03:00-07:00" pubdate data-updated="true">Dec 31<span>st</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/code/'>Code</a>, <a class='category' href='/blog/categories/dns/'>dns</a>, <a class='category' href='/blog/categories/heroku/'>heroku</a>
  
</span>


    </p>
    
      <div class="sharing"></div>

    
    <p class="meta">
      
        <a class="prev-article-link" href="/post/define-dynamic-methods-ruby/" title="Previous Post: Define Methods Dynamically in Ruby">&laquo; Define Methods Dynamically in Ruby</a>
      
      
        <a class="next-article-link" href="/post/grunt-init-exercism-io/" title="Next Post: Grunt-init Exercism.io">Grunt-init Exercism.io &raquo;</a>
      
    </p>
  </footer>
</article>

  <section class="comments">
    <h2 class="comments-title">Comments</h2>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

    </div>
  </div>
  <div class="container">
    <footer class="main-footer" role="contentinfo"><p>
  <a href="http://creativecommons.org/licenses/by/3.0/us/">CC 3.0 Attribution</a> 2014 -
  <a href="https://plus.google.com/115032056022257436849?rel=author">Jake Trent</a> -
  <a href="/atom.xml">Feed</a>
  <span class="main-footer-extras">-
    <a href="/sitemap.xml">Sitemap</a> -
    <a href="https://github.com/jaketrent/jaketrent-blog/issues">Report a Bug</a> -
    <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
  </span>
</p>

</footer>
  </div>
  

<script type="text/javascript">
      var disqus_shortname = 'jaketrent';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://jaketrent.com/post/add-zerigo-dns-to-heroku/';
        var disqus_url = 'http://jaketrent.com/post/add-zerigo-dns-to-heroku/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





</body>
</html>
