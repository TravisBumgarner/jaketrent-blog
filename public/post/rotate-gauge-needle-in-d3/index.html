
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Rotate Gauge Needle in D3 - Jake Trent</title>
  <meta name="author" content="Jake Trent">

  
  <meta name="description" content="If you want to make a gauge chart in S3, you'll need a needle on your gauge. It's not hard to draw a triangle, but here's the extra work to rotate it.">
  <meta name="keywords" content="rotate, triangle, d3, svg">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://jaketrent.com/post/rotate-gauge-needle-in-d3/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Jake Trent" type="application/atom+xml">
  <meta name="google-site-verification" content="uvx7BhaUTNz29nQgydsFPRsErfqYBhPEV_svnHvW7H0" />

<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-16224416-4']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1 class="title"><a href="/">Jake Trent</a></h1>
  <div class="desc">
    
      <h2>Code Slayer</h2>
    
  </div>
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:jaketrent.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/blog/categories/code/">Code</a></li>
  <li><a href="/blog/categories/design/">Design</a></li>
  <li><a href="/blog/categories/productivity/">Productivity</a></li>
  <li><a href="/blog/categories/review/">Reviews</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Rotate Gauge Needle in D3</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-09-27T06:52:00-06:00" pubdate data-updated="true">Sep 27<span>th</span>, 2013</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>If you want to make a gauge chart in S3, you&#8217;ll need a needle on your gauge.  It&#8217;s not hard to draw a triangle, but here&#8217;s the extra work to rotate it.</p>

<p><img src="http://i.imgur.com/7GSyOFd.png" alt="D3 Gauge Chart" /></p>

<!--more-->


<h2>The Gauge Chart</h2>

<p>I&#8217;m not sure what you call this kind of chart, but I call it a gauge.  It pretty much looks like a speedometer or a pressure gauge.  I&#8217;m sure after seeing one, you want to make one.  I&#8217;m not going to cover the arc building.  It&#8217;s pretty easy to build a <a href="https://github.com/mbostock/d3/wiki/SVG-Shapes#wiki-arc">d3 arc</a>.</p>

<h2>The Components</h2>

<p>In my case, I can match the design of the needle with a triangle and a circle.  The circle is the base of the needle upon which the needle spins.  The triangle is the pointer of the needle, which will eventually sit at the angle we specify to our graph.</p>

<h2>The Coordinates</h2>

<p>In svg/d3, you can redefine your coordinates by using a group.  If my <code>svg</code> container is square, the default coordinate plane will start in the upper left-hand corner at <code>(0,0)</code>.  If I wanted to redefine <code>(0,0)</code> to be in the bottom center of the <code>svg</code> container, we could do so by positioning a group (<code>g</code>) so that <em>its</em> top left-hand corner is at that point.</p>

<p>We might write this:</p>

<figure class='code'><figcaption><span>gauge.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nv">height = </span><span class="c1"># ... svg height</span>
</span><span class='line'><span class="nv">width = </span><span class="c1"># ... svg width</span>
</span><span class='line'><span class="nv">needleG = </span><span class="nx">svg</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s">&#39;g&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&#39;transform&#39;</span><span class="p">,</span> <span class="s">&quot;translate(</span><span class="si">#{</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="si">}</span><span class="s">, </span><span class="si">#{</span><span class="nx">height</span><span class="si">}</span><span class="s">)&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Draw a Triangle</h2>

<p>To draw a triangle, use an <a href="https://github.com/mbostock/d3/wiki/SVG-Shapes#path-data-generators">svg path</a>.  It needs a start point and 2 more points to draw lines to.  In the special language of svg <code>path</code>s, <code>M x y</code> is the start point and <code>L x y</code> is the point to which a straight light will be drawn from the previous point.</p>

<p>Let&#8217;s say that we want our needle to 60px tall and 20px wide at the base.  First we&#8217;ll draw it pointing straight up.  Let&#8217;s draw this triangle using the <code>needleG</code> coordinates.  In the code, I&#8217;ll call the corners of the triangle <code>top</code>, <code>left</code>, and <code>right</code>.  The d3 code to draw this might look like:</p>

<figure class='code'><figcaption><span>gauge.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nv">needleLen = </span><span class="mi">60</span>
</span><span class='line'><span class="nv">needleRadius = </span><span class="mi">10</span>
</span><span class='line'>
</span><span class='line'><span class="nv">centerX = </span><span class="mi">0</span>
</span><span class='line'><span class="nv">centerY = </span><span class="mi">0</span>
</span><span class='line'>
</span><span class='line'><span class="nv">topX = </span><span class="nx">centerX</span> <span class="o">-</span> <span class="mi">0</span>
</span><span class='line'><span class="nv">topY = </span><span class="nx">centerY</span> <span class="o">-</span> <span class="nx">needleLen</span>
</span><span class='line'>
</span><span class='line'><span class="nv">leftX = </span><span class="nx">centerX</span> <span class="o">-</span> <span class="nx">needleRadius</span>
</span><span class='line'><span class="nv">leftY = </span><span class="nx">centerY</span> <span class="o">-</span> <span class="mi">0</span>
</span><span class='line'>
</span><span class='line'><span class="nv">rightX = </span><span class="nx">centerX</span> <span class="o">-</span> <span class="o">-</span><span class="p">(</span><span class="nx">needleRadius</span><span class="p">)</span>
</span><span class='line'><span class="nv">rightY = </span><span class="nx">centerY</span> <span class="o">-</span> <span class="mi">0</span>
</span><span class='line'>
</span><span class='line'><span class="nx">needleG</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s">&#39;path&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="s">&quot;M </span><span class="si">#{</span><span class="nx">leftX</span><span class="si">}</span><span class="s"> </span><span class="si">#{</span><span class="nx">leftY</span><span class="si">}</span><span class="s"> L </span><span class="si">#{</span><span class="nx">topX</span><span class="si">}</span><span class="s"> </span><span class="si">#{</span><span class="nx">topY</span><span class="si">}</span><span class="s"> L </span><span class="si">#{</span><span class="nx">rightX</span><span class="si">}</span><span class="s"> </span><span class="si">#{</span><span class="nx">rightY</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Rotate the Triangle</h2>

<p>Drawing a triangle pointed straight up, that is strictly parallel with the <code>x</code> and <code>y</code> access of the plane, is no problem.  But a gauge that points straight up isn&#8217;t worth that much.  It doesn&#8217;t measure anything.  So, let&#8217;s rotate the pointer/triangle of the needle to get an actual visual display of our measurement.</p>

<p>Unfortunately, (but maybe you&#8217;ll have fun) you&#8217;ll have to pull out your middle school trigonometry here.  I was remembering sayings I had heard once a time to figure this out (like the mysterious &#8220;SOHCAHTOA&#8221; acronym).</p>

<h3>Percentage Input</h3>

<p>Your input may vary, but mine starts as a percentage.  If yours does not, you could convert it to a percentage.  And since we&#8217;re working with a half circle, we&#8217;re just going to cut in half all our input since the rotation math is based on a circle.</p>

<p>Let&#8217;s say in this case our percentage is 65%.  We need to convert from percentage to radians.  Note that all the code for rotation angles will use <a href="http://en.wikipedia.org/wiki/Radian">radians</a>.  Here&#8217;s some conversion code:</p>

<figure class='code'><figcaption><span>gauge.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nv">percToDeg = </span><span class="nf">(perc) -&gt;</span>
</span><span class='line'>  <span class="nx">perc</span> <span class="o">*</span> <span class="mi">360</span>
</span><span class='line'>
</span><span class='line'><span class="nv">percToRad = </span><span class="nf">(perc) -&gt;</span>
</span><span class='line'>  <span class="nx">degToRad</span> <span class="nx">percToDeg</span> <span class="nx">perc</span>
</span><span class='line'>
</span><span class='line'><span class="nv">degToRad = </span><span class="nf">(deg) -&gt;</span>
</span><span class='line'>  <span class="nx">deg</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">/</span> <span class="mi">180</span>
</span></code></pre></td></tr></table></div></figure>


<h3>SOHCAHTOA</h3>

<p>We have to find the <code>top</code>, <code>left</code>, and <code>right</code> for a triangle rotated around the <code>(0,0)</code> point.  The basic SOHCAHTOA formulas will help us find the points:</p>

<figure class='code'><figcaption><span>gauge.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nx">sin</span> <span class="k">of</span> <span class="nv">angle = </span><span class="nx">opposite</span> <span class="o">/</span> <span class="nx">hypotenuse</span>
</span><span class='line'><span class="nx">cos</span> <span class="k">of</span> <span class="nv">angle = </span><span class="nx">adjacent</span> <span class="o">/</span> <span class="nx">hypotenuse</span>
</span><span class='line'><span class="nx">tan</span> <span class="k">of</span> <span class="nv">angle = </span><span class="nx">opposite</span> <span class="o">/</span> <span class="nx">adjacent</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://i.imgur.com/RxoQF98.png" alt="Needle trigonometry" /></p>

<p>Using these formulas, let&#8217;s update our code for finding the endpoints of the triangle:</p>

<figure class='code'><figcaption><span>gauge.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nv">needleLen = </span><span class="mi">60</span>
</span><span class='line'><span class="nv">needleRadius = </span><span class="mi">10</span>
</span><span class='line'><span class="nv">percent = </span><span class="p">.</span><span class="mi">65</span>
</span><span class='line'>
</span><span class='line'><span class="nv">thetaRad = </span><span class="nx">percToRad</span> <span class="nx">percent</span> <span class="o">/</span> <span class="mi">2</span>
</span><span class='line'>
</span><span class='line'><span class="nv">centerX = </span><span class="mi">0</span>
</span><span class='line'><span class="nv">centerY = </span><span class="mi">0</span>
</span><span class='line'>
</span><span class='line'><span class="nv">topX = </span><span class="nx">centerX</span> <span class="o">-</span> <span class="nx">needleLen</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">thetaRad</span><span class="p">)</span>
</span><span class='line'><span class="nv">topY = </span><span class="nx">centerY</span> <span class="o">-</span> <span class="nx">needleLen</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">thetaRad</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="nv">leftX = </span><span class="nx">centerX</span> <span class="o">-</span> <span class="nx">needleRadius</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">thetaRad</span> <span class="o">-</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
</span><span class='line'><span class="nv">leftY = </span><span class="nx">centerY</span> <span class="o">-</span> <span class="nx">needleRadius</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">thetaRad</span> <span class="o">-</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="nv">rightX = </span><span class="nx">centerX</span> <span class="o">-</span> <span class="nx">needleRadius</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">thetaRad</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
</span><span class='line'><span class="nv">rightY = </span><span class="nx">centerY</span> <span class="o">-</span> <span class="nx">needleRadius</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">thetaRad</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="s">&quot;M </span><span class="si">#{</span><span class="nx">leftX</span><span class="si">}</span><span class="s"> </span><span class="si">#{</span><span class="nx">leftY</span><span class="si">}</span><span class="s"> L </span><span class="si">#{</span><span class="nx">topX</span><span class="si">}</span><span class="s"> </span><span class="si">#{</span><span class="nx">topY</span><span class="si">}</span><span class="s"> L </span><span class="si">#{</span><span class="nx">rightX</span><span class="si">}</span><span class="s"> </span><span class="si">#{</span><span class="nx">rightY</span><span class="si">}</span><span class="s">&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note that <code>Math.PI / 2</code> is a 90 degree angle.  It&#8217;s used to find the angle smaller than theta for the left triangle and find the angle larger for the right triangle.</p>

<p>There you have it.  That&#8217;s the magic.  For an example of this working and some more code, see this <a href="http://cdpn.io/eloGk">codepen of a d3 gauge</a>.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Jake Trent</span></span>

      








  


<time datetime="2013-09-27T06:52:00-06:00" pubdate data-updated="true">Sep 27<span>th</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/code/'>Code</a>, <a class='category' href='/blog/categories/coffeescript/'>coffeescript</a>, <a class='category' href='/blog/categories/d3/'>d3</a>, <a class='category' href='/blog/categories/js/'>js</a>, <a class='category' href='/blog/categories/svg/'>svg</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://jaketrent.com/post/rotate-gauge-needle-in-d3/" data-via="" data-counturl="http://jaketrent.com/post/rotate-gauge-needle-in-d3/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/post/import-erb-into-karma/" title="Previous Post: Import Erb Into Karma">&laquo; Import Erb Into Karma</a>
      
      
        <a class="basic-alignment right" href="/post/start-review/" title="Next Post: Start Review">Start Review &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <ul id="social">
    <li><a class="social social-github" href="http://github.com/jaketrent" title="Github" class="first">Github</a></li>
    <li><a class="social social-twitter" href="http://twitter.com/jaketrent" title="Twitter">Twitter</a></li>
    <li><a class="social social-linkedin" href="http://linkedin.com/in/jaketrent" title="LinkedIn">LinkedIn</a></li>
    <li><a class="social social-googleplus" href="https://plus.google.com/115032056022257436849?rel=author" title="Google Plus">Google Plus</a></li>
    <li><a class="social social-rss" href="/atom.xml" title="RSS">RSS</a></li>
  </ul>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/post/change-page-title-angular-route/">Change Page Title in Angular Route</a>
      </li>
    
      <li class="post">
        <a href="/post/use-d3-rangebands/">Use D3 rangeBands</a>
      </li>
    
      <li class="post">
        <a href="/post/start-review/">Start Review</a>
      </li>
    
      <li class="post">
        <a href="/post/rotate-gauge-needle-in-d3/">Rotate Gauge Needle in D3</a>
      </li>
    
      <li class="post">
        <a href="/post/import-erb-into-karma/">Import Erb Into Karma</a>
      </li>
    
  </ul>
</section>




<section class="googleplus googleplus-hidden">
  <h1>
    <a href="https://plus.google.com/115032056022257436849?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Jake Trent -
  <a href="/blog/archives">Archives</a> -
  <a href="/atom.xml">Feed</a> -
  <a href="/sitemap.xml">Sitemap</a> -
  <a href="https://github.com/jaketrent/jaketrent-blog/issues">Report a Bug</a> -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'jaketrent';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://jaketrent.com/post/rotate-gauge-needle-in-d3/';
        var disqus_url = 'http://jaketrent.com/post/rotate-gauge-needle-in-d3/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
